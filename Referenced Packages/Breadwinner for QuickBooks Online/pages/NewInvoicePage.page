<apex:page sidebar="false" standardcontroller="breadwinner_qbo__Invoice__c" extensions="breadwinner_qbo.CreateInvoiceExtension" id="pg" title="{!IF(showAccountPanel,'New QuickBooks Online Customer', 'Select QuickBooks Online Customer')}" action="{!actionMethod}">
    <html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
        
        <head>
            <apex:stylesheet value="{!URLFOR($Resource.breadwinner_qbo__Breadwinner_QBO, 'Breadwinner_QBO/SLDS/assets/styles/salesforce-lightning-design-system-vf.min.css')}" ></apex:stylesheet>
            <script src="{!URLFOR($Resource.Breadwinner_QBO, 'Breadwinner_QBO/JS/jquery-1.11.3.js')}"></script>
        
        <script>
            
            var j$ = jQuery.noConflict();
            function HideStyleSheet(){
                j$("link.user[href$='elements.css']").each(function(){
                    j$(this).removeAttr("href");
                });
            }
            function message()
            {

                j$(".infoM6, .infoM4, .infoM3, .infoM2, .infoS1").addClass("slds-notify slds-notify--alert slds-theme--inverse-text  slds-text-align--left slds-text-heading--small slds-m-bottom--small").css( {"font-weight":"500","line-height":"1.4","word-spacing":"1px"} );
                j$(".errorM6, .errorM4, .errorM3, .errorM2, .errorS1").addClass("slds-notify slds-notify--alert slds-theme--error  slds-text-align--left slds-text-heading--small slds-m-bottom--small").css( {"font-weight":"500","line-height":"1.4","word-spacing":"1px"} );
                j$(".warningM6, .warningM4, .warningM3, .warningM2, .warningS1").addClass("slds-notify slds-notify--alert slds-theme--warning  slds-text-align--left slds-text-heading--small slds-m-bottom--small").css( {"font-weight":"500","line-height":"1.4","word-spacing":"1px"} ) ;
                j$(".confirmM6, .confirmM4, .confirmM3, .confirmM2, .confirmS1").addClass("slds-notify slds-notify--alert slds-theme--success slds-text-align--left slds-text-heading--small slds-m-bottom--small").css( {"font-weight":"500","line-height":"1.4","word-spacing":"1px"} ) ;               
                
                j$("div .messageText h4").css( {"color": "white","padding-right" : "2px"});
                j$("div[class*='warning'] div.messageText h4").css( "color", "black" );
                j$("table.messageTable td").css({"color" : "white"});
                j$("div[class*='warning'] table.messageTable td").css( "color", "black" );
            }
            function selectTransactio(elevalue){
                j$("input[id$='selectedTranGatewayId']").val(elevalue);
            }
            j$(function(){
                HideStyleSheet();
                message();
            });
            function identifyfield(elementt,helptext,TopMinusParam,LeftMinusParam){
                
                var x = j$(elementt).offset();
                //alert("Top position: " + x.top + " Left position: " + x.left+" height: "+$(elementt).height());                
                var ToSetleft=x.left-LeftMinusParam;                
                j$("#help p").text(helptext);                
                var ToSetheight=x.top-TopMinusParam;                
                var heptextdiv=document.getElementById("help");
                j$(heptextdiv).css({
                    top: ToSetheight,
                    left: ToSetleft,
                    display:""
                })
                
            }
            function mouseoutclose(){
                var heptextdiv=document.getElementById("help");
                j$(heptextdiv).css({top:"0px",left:"0px",display:"none"});
            }
       </script>
    <style>
       
       .BreadwinnerLightning .slds-section__title {
            font-size: 1.05rem;
        }
        .BreadwinnerLightning .slds-page-header__detail-block {
            max-width: inherit;
            width: 15%;
        }
        .BreadwinnerLightning .slds-radio .slds-form-element__label {
            font-size: 1.15em;
        }
        .BreadwinnerLightning .slds-notify--alert {
            padding: 0.5rem;
            text-align: justify;
        }

        .BreadwinnerLightning .slds-section-title--divider {
            font-size: 1.4em;
            line-height: 1.25;
            color: #54698d;
            text-transform: capitalize;
            padding: 0.75rem 1rem;
            background: #f4f6f9;
        }
        .message {
            background-color: inherit;
            border-style: none;
            padding:initial;
        }
        .msgIcon{
            display:none;
        }
        .message .messageText {
            margin: 0px;
        }
        .message .messageText h4 {
            font-weight: inherit;
            display: initial;
        }
        .select-editable {
            position:relative;
            background-color:white;
            border:solid  #d8dde6 1px;
            width:100%;
            line-height: 1.875rem;
            min-height: calc(1.875rem + (1px * 2));
            display: inline-block;
            border-radius: .25rem;
            padding: 0 1rem 0 .75rem;
            transition: border .1s linear,background-color .1s linear;
            background-color: white;
        }
        .divfocus {
            outline: 0;
            border-color: #1589ee;
            background-color: #fff;
            box-shadow: 0 0 3px #0070D2;
        }
        .select-editable select {
            position:absolute;
            top: 0.25rem;
            left:0px;
            border:none;
            width:100%;
            margin:0;
            padding: 4px 1rem 0 .75rem;
            background-color: white;
        }
        .select-editable input {
            position:absolute;
            top:0.25rem;
            left:0px;
            width:92%;
            padding: 4px 1rem 0 .75rem;
            border:none;
        }
        .select-editable select:focus, .select-editable input:focus {
            outline:none;
        }
        .BreadwinnerLightning hr{
            margin-top: 11px;
            margin-bottom: -11px;
        }
            </style>
        </head>
        <body>
        <apex:form id="theForm">
                        

            <div class="BreadwinnerLightning">
                
                <!-- ----------------------------------- fields level help ---------------------------------- -->
                <div id="help"  class="slds-popover slds-popover--tooltip slds-nubbin--bottom-left" role="tooltip" aria-live="polite" style="display:none;position:absolute;top:0px;left:0px;">
                    <div class="slds-popover__body slds-text-longform">
                        <p>Help text will come here dynamically</p>
                    </div>
                </div>
                <!-- ----------------------------------- fields level help ---------------------------------- -->
                
                <apex:pageMessages id="pmg" escape="false"></apex:pageMessages>
		        <apex:actionstatus id="actioin_status">
                    <apex:facet name="start">
                        <div class="slds-spinner_container">
                          <div class="slds-spinner--brand slds-spinner slds-spinner--large" role="alert">
                            <span class="slds-assistive-text">Loading</span>
                            <div class="slds-spinner__dot-a"></div>
                            <div class="slds-spinner__dot-b"></div>
                          </div>
                        </div>
                    </apex:facet>
                </apex:actionstatus>
                <apex:outputPanel layout="block" styleClass="warningM3" style="color:black;" rendered="{!subscribeBreadwinner}">
                    <b> Your trial/subscription has expired </b>
                    <br/>
                    You must have a valid subscription to Breadwinner to create and sync invoices. Please visit the Billing section of Breadwinner tab for more info.
                </apex:outputPanel>
                <apex:outputPanel style="font-size:14px; " rendered="{!OR(notInitializedWithAccount,isInvoiceFromLead,AND(isInvoiceFromCustomURL, Plan_Code < 80),AND(isInvoiceFromCustomLineItemURL, Plan_Code < 80))}">
                    <apex:outputPanel rendered="{!OR(notInitializedWithAccount,isInvoiceFromLead)}">
                    <div class="slds-m-top--small" >
                        <apex:pageMessage rendered="{!notInitializedWithAccount}" summary="Please go to the Account or Opportunity from which you want to create this new Invoice. " detail="If that Account doesn't exist yet, please create it first." severity="Warning" strength="3" />
                        <apex:pageMessage rendered="{!isInvoiceFromLead}" summary="Sorry, You can not create Invoices from Leads." detail="This is because once the Lead is converted it is no longer accessible through the User Interface." severity="Warning" strength="3" />
                    </div>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!OR(AND(isInvoiceFromCustomURL, Plan_Code < 80),AND(isInvoiceFromCustomLineItemURL, Plan_Code < 80))}">
                         <apex:pagemessage rendered="{!AND(isInvoiceFromCustomURL, Plan_Code < 80)}" summary="Sorry, you must be on a higher subscription to create an Invoice using Custom URL, please contact support from Breadwinner tab." severity="error" strength="3"></apex:pagemessage>
                        <apex:pagemessage rendered="{!AND(isInvoiceFromCustomLineItemURL, Plan_Code < 80)}" summary="Sorry, you must be on a higher subscription to create an Invoice using Custom Line Items URL, please contact support from Breadwinner tab." severity="error" strength="3"></apex:pagemessage>
                     </apex:outputPanel>
                </apex:outputPanel>
                <apex:outputPanel id="mainPanel" rendered="{!initialized}">
                    <apex:outputPanel id="newInvoicePanel" rendered="{!showInvoicePanel}">
                        <!-- ----------------------------------------------------Page Header Start----------------------------------------------------------- -->
                        <div class="slds-page-header" role="banner">
                            <div class="slds-media slds-media--center">
                                <div class="slds-media__figure">
                                    <svg aria-hidden="true" class="slds-icon slds-icon-standard-user">
                                        <use xlink:href="{!URLFOR($Resource.Breadwinner_QBO, 'Breadwinner_QBO/SLDS/assets/icons/utility-sprite/svg/symbols.svg#moneybag')}"></use>
                                    </svg>
                                </div>
                                <div class="slds-media__body">
                                    <p class="slds-page-header__title">New QuickBooks Online Invoice</p>
                                    <p class="slds-text-body--small">Breadwinner • QuickBooks Online </p>
                                </div>
                            </div>
                        </div>
                        <apex:pageMessage rendered="{!isOAuthIssue}" escape="false" detail="{!oAuthExceptionWarningMessage}" summary="There was a problem with the connection to QuickBooks Online:" severity="WARNING" strength="3"/>
                        <!-- ----------------------------------------------------Page Header END----------------------------------------------------------- -->

                        <!-- ----------------------------------------------------Opportunity Section Start----------------------------------------------------------- -->
                        <div class="slds-grid slds-wrap ">
                            <div class="slds-m-top--medium slds-col--padded slds-size--1-of-1 slds-medium-size--3-of-6 slds-large-size--6-of-12"  style="display:{!IF(AND(NOT(isNoAccesOptyProduct),OR(isInvoiceFromOrder, NOT(ISBLANK(sfInvoice.Opportunity__c)), NOT(ISBLANK(Parent_Object_Id)) )) ,'','none')};">
                                <apex:outputPanel rendered="{!ISBLANK(Parent_Object_Id)}">
                                    <h3 class="slds-section__title">Using {!IF(isInvoiceFromOrder, 'Order','Opportunity')} Products</h3>
                                    
                                    <apex:outputPanel rendered="{!AND(ISBLANK(sfInvoice.breadwinner_qbo__Opportunity__c), NOT(isInvoiceFromOrder))}">
                                             <apex:pageMessage severity="info" strength="3"  summary="Opportunity Products can only be added to an Invoice when clicking 'New Invoice' from that Opportunity."></apex:pageMessage>
                                     </apex:outputPanel>
                                    
                                    <apex:outputPanel rendered="{!OR(isInvoiceFromOrder, NOT(ISBLANK(sfInvoice.breadwinner_qbo__Opportunity__c)))}">
                                        <script>
                                        function oppselect(inputvalue) {
                                            document.getElementById('{!JSENCODE($Component.theForm.OppSelectId)}').value = inputvalue;
                                        }
                                        </script>
                                        <apex:inputHidden id="OppSelectId" value="{!UseOpportunityProducts}" />
                                        
                                        <fieldset class="slds-form-element slds-m-top--small">
                                            
                                            <div class="slds-form-element__control">
                                                <label class="slds-radio">
                                                    <input type="radio" name="oppoptions" id="DoNotUse" onclick="oppselect('DoNotUse')" />
                                                    <span class="slds-radio--faux"></span>
                                                    <span class="slds-form-element__label">{!IF(ISBLANK(sfInvoice.Opportunity__c),'Blank Invoice','Do not use Opportunity Products')}</span>
                                                </label>
                                                <label class="slds-radio">
                                                    <apex:outputPanel rendered="{!opportunityHaveProducts}">
                                                        <input type="radio" name="oppoptions" id="UseProducts" onclick="oppselect('UseProducts')" />
                                                        <span class="slds-radio--faux"></span>
                                                        <span class="slds-form-element__label">{!IF(opportunityHaveProducts,'Pre-Populate Invoice with '&IF(isInvoiceFromOrder, 'Order','Opportunity')&' Products','(there are no '&IF(isInvoiceFromOrder, 'Order','Opportunity')&' Products on this '&IF(isInvoiceFromOrder, 'Order','Opportunity')&')')}</span>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!NOT(opportunityHaveProducts)}">
                                                        <span class="slds-form-element__label slds-m-left--large">{!IF(opportunityHaveProducts,'Pre-Populate Invoice with '&IF(isInvoiceFromOrder, 'Order','Opportunity')&' Products','(There are no '&IF(isInvoiceFromOrder, 'Order','Opportunity')&' Products on this '&IF(isInvoiceFromOrder, 'Order','Opportunity')&')')}</span>
                                                    </apex:outputPanel>
                                                </label>
                                            </div>
                                            <apex:outputPanel layout="block" styleClass="slds-form-element__control" rendered="{!isInvoiceLineItemfromOpptyfieldsEnabled}">
                                                <div class="slds-text-body--small"> 
                                                    <label class="slds-checkbox slds-m-top--small">
                                                        <apex:inputCheckbox value="{!isInvoiceLineItemfromOpptyfieldsEnabled}"  />
                                                        <span class="slds-checkbox--faux"></span>
                                                        <span class="slds-form-element__label">
                                                            Include Invoice Line Item from Opportunity fields
                                                            <apex:outputPanel styleClass="slds-m-left--small slds-form-element__icon">
                                                                <a href="javascript:void(0);" onmouseover="identifyfield(this,'Invoice Line Item from Opportunity fields mapping can be done on Invoice Configuration section of Breadwinner tab.','183','26')" onmouseout="mouseoutclose();">
                                                                    <img style="margin-bottom: 4px;height:15px;width:15px;" src="{!URLFOR($Resource.Breadwinner_QBO, 'Breadwinner_QBO/Images/InfoLightning.png')}"/><span class="slds-assistive-text">Help</span>
                                                                </a>
                                                            </apex:outputPanel>
                                                        </span>
                                                    </label>
                                                </div>
                                            </apex:outputPanel>
                                        </fieldset>
                                        <script>
                                        document.getElementById('{!JSENCODE(UseOpportunityProducts)}').checked = true;
                                        </script>
                                    </apex:outputPanel>
                                    
                                </apex:outputPanel>
                                <apex:outputPanel rendered="{!NOT(ISBLANK(Parent_Object_Id))}">
                                    <h3 class="slds-section__title">{!IF( NOT(ISBLANK(Child_Relationship_Name)),'Using '+Child_Object_Plural_Label, IF(isLineItemURL, 'Using '+Parent_Object_Label, 'Blank Invoice'))}</h3>
                                    <apex:outputPanel >
                                        <script>
                                        function lineselect(inputvalue) {
                                            document.getElementById('{!JSENCODE($Component.theForm.lineSelectId)}').value = inputvalue;
                                        }
                                        </script>
                                        <apex:inputHidden id="lineSelectId" value="{!UseCustomLineItems}" />
                                        
                                        <fieldset class="slds-form-element slds-m-top--small">
                                            
                                            <div class="slds-form-element__control">
                                                <label class="slds-radio">
                                                    <input type="radio" name="lineoptions" id="DoNotUse" onclick="lineselect('DoNotUse')" />
                                                    <span class="slds-radio--faux"></span>
                                                    <span class="slds-form-element__label">Blank Invoice</span>
                                                </label>
                                                <label class="slds-radio">
                                                    <apex:outputPanel rendered="{!NOT(AND(NOT(isLineItemURL), OR(NOT(SobjectHasLineItems),ISBLANK(Child_Relationship_Name))))}">
                                                        <input type="radio" name="lineoptions" id="UseLineItems" onclick="lineselect('UseLineItems')" />
                                                        <span class="slds-radio--faux"></span>
                                                        <span class="slds-form-element__label">{!IF(ISBLANK(Child_Relationship_Name), IF(isLineItemURL, 'Custom Line Items will be populated, if any', 'No object chosen to pre-populate Line Items'), IF(SobjectHasLineItems,'Pre-Populate Invoice with '+Child_Object_Plural_Label,'(there are no '+Child_Object_Plural_Label+' on this '+Parent_Object_Label+')'))}</span>
                                                    </apex:outputPanel>
                                                    <apex:outputPanel rendered="{!AND(NOT(isLineItemURL), OR(NOT(SobjectHasLineItems),ISBLANK(Child_Relationship_Name)))}">
                                                        <span class="slds-form-element__label slds-m-left--large">{!IF(ISBLANK(Child_Relationship_Name), IF(isLineItemURL, 'Custom Line Items will be populated, if any', 'No object chosen to pre-populate Line Items'), IF(SobjectHasLineItems,'Pre-Populate Invoice with '+Child_Object_Plural_Label,'(there are no '+Child_Object_Plural_Label+' on this '+Parent_Object_Label+')'))}</span>
                                                    </apex:outputPanel>
                                                </label>
                                            </div>
                                        </fieldset>
                                        <script>
                                        document.getElementById('{!JSENCODE(UseCustomLineItems)}').checked = true;
                                        </script>
                                    </apex:outputPanel>
                                    
                                </apex:outputPanel>
                                
                            </div>
                            <div class="slds-m-top--medium slds-col--padded slds-size--1-of-1 slds-medium-size--3-of-6 slds-large-size--6-of-12" style='display:{!if(OR((NOT(isMultiOrgEnabled)&&syncSalesReceiptsEnabled),isMultiOrgEnabled),"block","none")}'>
                                <apex:outputPanel >
                                    <h3 class="slds-section__title">Create this transaction as</h3>
                                    <script>
                                        function Invoiceselect(inputvalue) {
                                            document.getElementById('{!JSENCODE($Component.theForm.seletedInvoiceorSalesReceipt)}').value = inputvalue;
                                            reRenderChargentSection();
                                        }
                                    </script>
                                    <apex:inputHidden id="seletedInvoiceorSalesReceipt" value="{!invoiceOrSalesReceipt}" />
                                    <fieldset class="slds-form-element slds-m-top--small">
                                        <div class="slds-form-element__control">
                                            <label class="slds-radio">
                                                <input type="radio" name="Invoptions" id="invoice" onclick="Invoiceselect('invoice')" />
                                                <span class="slds-radio--faux"></span>
                                                <span class="slds-form-element__label">Invoice</span>
                                            </label>
                                            <label class="slds-radio">
                                                <input type="radio" name="Invoptions" id="salesReceipt" onclick="Invoiceselect('salesReceipt')" />
                                                <span class="slds-radio--faux"></span>
                                                <span class="slds-form-element__label">Sales Receipt
                                                </span>
                                            </label>
                                        </div>
                                    </fieldset>
                                    <script>
                                    document.getElementById('{!JSENCODE(invoiceOrSalesReceipt)}').checked = true;
                                    </script>
                                </apex:outputPanel>
                            </div>
                        </div>
                        <apex:actionFunction name="reRenderChargentSection" reRender="ChargentPaymentSection" />
                        <!-- ----------------------------------------------------Opportunity Section END----------------------------------------------------------- -->
                        <apex:outputPanel id="ChargentPaymentSection">
                            <apex:outputPanel layout="block" styleclass="slds-m-top--medium slds-col--padded" rendered="{!AND(sfInvoice.breadwinner_qbo__Opportunity__c!=null,isAllowedToUseChargentTransaction,invoiceOrSalesReceipt=='invoice')}">
                                <hr/>
                                <h1 class="slds-section__title slds-m-top--large">Transaction Info</h1>
                                <div class="slds-text-body--small slds-m-horizontal--small slds-m-top--small" style="color: gray;">
                                    The Chargent Transaction shown below will be created in QuickBooks Online as a Payment and applied to the Invoice. Optionally you can choose to &nbsp;
                                    <apex:commandLink reRender="ChargentPaymentSection,pmg" value="not create a payment with Chargent Transaction." style="color: gray;text-decoration: underline;" >
                                        <apex:param name="DoNotApplyChargentTransaction" value="false" assignTo="{!isAllowedToUseChargentTransaction}"/>
                                    </apex:commandLink>
                                    &nbsp;<apex:commandLink reRender="ChargentPaymentSection,pmg" value="Not the transaction you want to apply?" style="text-decoration: underline;" rendered="{!isMultipleTransactionsExist&&isRecentTransactionsExist&&NOT(showAllTrasactionRecords)}" oncomplete="HideStyleSheet();message();">
                                        <apex:param name="showAlltransactionParam" value="true" assignTo="{!showAllTrasactionRecords}"/>
                                    </apex:commandLink>
                                </div>
                                <apex:outputPanel id="tranSection">
                                    <apex:outputPanel layout="block" styleClass="slds-m-horizontal--small infoM3 slds-m-top--small" style="border-radius: 5px;" rendered="{!AND(NOT(isRecentTransactionsExist),NOT(showAllTrasactionRecords))}">
                                        There are no Chargent Transactions from the last 14 days, however you can optionally 
                                         &nbsp;<apex:commandLink reRender="ChargentPaymentSection,pmg" action="{!QueryAllTransactionRecrods}" value="select older Chargent Transactions" style="text-decoration: underline;" oncomplete="HideStyleSheet();message();"  >
                                        <apex:param name="showAlltransactionParam" value="true" assignTo="{!showAllTrasactionRecords}"/>
                                        </apex:commandLink>.
                                    </apex:outputPanel>   
                                    <apex:outputPanel layout="block" rendered="{!AND(NOT(showAllTrasactionRecords),isRecentTransactionsExist)}" styleclass="slds-grid slds-wrap slds-m-top--small slds-m-bottom--small">
                                        <div class="slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-2">
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 ">
                                                <div class="slds-form-element">
                                                    <span class="slds-form-element__label">Gateway Transaction ID</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static">{!GatewayTrasactionId}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 ">
                                                <div class="slds-form-element">
                                                    <span class="slds-form-element__label">Chargent Transaction ID</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static">{!ChargentTrasactionId}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 ">
                                                <div class="slds-form-element">
                                                    <span class="slds-form-element__label">Amount</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static">{!ChargentPaymentAmount}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-2">
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 ">
                                                <div class="slds-form-element">
                                                    <span class="slds-form-element__label">Opportunity</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static">{!ChargentOpportunityName}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 ">
                                                <div class="slds-form-element">
                                                    <span class="slds-form-element__label">Payment Method</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static">{!ChargentPaymentMethod}</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 ">
                                                <div class="slds-form-element">
                                                    <span class="slds-form-element__label">Transaction Date/Time</span>
                                                    <div class="slds-form-element__control">
                                                        <span class="slds-form-element__static">{!ChargentTransactionCreatedDateTime}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </apex:outputPanel>
                                    <apex:outputPanel layout="block" rendered="{!showAllTrasactionRecords}">
                                        <div class="slds-text-body--small slds-m-horizontal--small slds-m-top--small" style="color: gray;">
                                            Please select one of the following transactions to apply as payment.
                                        </div>
                                        <table class="slds-table slds-table--bordered slds-max-medium-table--stacked-horizontal slds-m-top--medium">
                                            <thead>
                                                <tr class="slds-text-title--caps">
                                                    <th scope="col">
                                                        <div class="slds-truncate" title="Select?">Select?</div>
                                                    </th>
                                                    <th scope="col">
                                                        <div class="slds-truncate" title="Gateway Transaction ID">Gateway Transaction ID</div>
                                                    </th>
                                                    <th scope="col">
                                                        <div class="slds-truncate" title="Chargent Transaction ID">Chargent Transaction ID</div>
                                                    </th>
                                                    <th scope="col">
                                                        <div class="slds-truncate" title="Payment Method">Payment Method</div>
                                                    </th>
                                                    <th scope="col">
                                                        <div class="slds-truncate" title="Amount">Amount</div>
                                                    </th>
                                                    <th scope="col">
                                                        <div class="slds-truncate" title="Transaction Date/Time">Transaction Date/Time</div>
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <apex:repeat value="{!TransactionListSorted}" var="tran">
                                                    <tr>
                                                        <td data-label="Select?">
                                                            <span class="slds-radio">
                                                                <input type="radio" id="{!transactionsMap[tran].GatewayTransactionId}" name="Strans" onchange="selectTransactio('{!transactionsMap[tran].GatewayTransactionId}');"/>
                                                                <label class="slds-radio__label" for="{!transactionsMap[tran].GatewayTransactionId}">
                                                                    <span class="slds-radio--faux"></span>
                                                                </label>
                                                            </span>
                                                        </td>
                                                        <td data-label="Gateway Transaction ID">{!transactionsMap[tran].GatewayTransactionId}</td>
                                                        <td data-label="Chargent Transaction ID">{!transactionsMap[tran].TransactionId}</td>
                                                        <td data-label="Payment Method">{!transactionsMap[tran].PaymentMethod}</td>
                                                        <td data-label="Amount">{!transactionsMap[tran].PaymentAmount}</td>
                                                        <td data-label="Transaction Date/Time">{!transactionsMap[tran].TransactionCreatedDateTime}</td>
                                                    </tr>
                                                </apex:repeat>
                                            </tbody>
                                        </table>
                                        <apex:inputHidden value="{!selectedTransactionGatewayId}" id="selectedTranGatewayId"/>
                                        <script>
                                        document.getElementById('{!JSENCODE(selectedTransactionGatewayId)}').checked = true;
                                        </script>
                                        <script>
                                        document.getElementById('{!JSENCODE(GatewayTrasactionId)}').checked = true;
                                        </script>
                                    </apex:outputPanel>
                                </apex:outputPanel>
                            </apex:outputPanel>
                        </apex:outputPanel>
                        
                        <!-- ----------------------------------------------------Select Customer Start----------------------------------------------------------- -->
                        <apex:outputPanel id="theBlock" rendered="{!$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.accessible}">
                        <hr/>
                        <div class="slds-m-top--medium slds-col--padded">
                            <h1 class="slds-section__title">Select the QuickBooks Online Customer for this {!IF(syncSalesReceiptsEnabled, 'Transaction', 'Invoice')}</h1>
                            <fieldset class="slds-form-element slds-m-top--medium">
                                <div class="slds-form-element__control">
                                    <label class="slds-radio">
                                        <input type="radio" name="customeroptions" id="createNewAccount" onchange="pushselectedQBOAccount('createNewQBOAccount'); " value="createNew" />
                                        <span class="slds-radio--faux"></span>
                                        <span class="slds-form-element__label">Create a new QuickBooks Online Customer</span>
                                        <div class="slds-m-left--x-large slds-text-body--small">You can have multiple QuickBooks Online Customers associated with a single Salesforce Account. This might happen if you have different departments, branches, or offices of the same company. </div>

                                    </label>
                                    <apex:repeat value="{!selectedAccount.QBO_Companies__r}" var="xA">
                                        <apex:outputPanel rendered="{!xA.breadwinner_qbo__Reference_Id__c!=NULL}">
                                            <label class="slds-radio slds-m-top--medium">
                                                <input type="radio" name="customeroptions" id="{!xA.Reference_Id__c}" onchange="pushselectedQBOAccount('{!xA.Reference_Id__c}'); " value="{!xA.Reference_Id__c}" />
                                                <span class="slds-radio--faux"></span>
                                                <span class="slds-form-element__label" for="{!xA.Reference_Id__c}"> 
                                                    Use Existing QuickBooks Online Customer: {!xA.Display_Name__c} &nbsp;&nbsp;&nbsp;&nbsp;
                                                    <apex:commandLink action="{!editQboContact}" value="Edit QuickBooks Online Contact before Creating the Invoice" style="color:grey;text-decoration:underline;" styleClass="slds-text-body--small" rendered="{!if(AND(Plan_code>=20,isAllowedToUpdateBAC), true, false)}">
                                                    <apex:param name="contIdParam" value="{!xA.id}" assignTo="{!qboContactEditId}"/>
                                                    </apex:commandLink>
                                                </span>
                                                <apex:outputPanel styleClass="" title="{!xA.breadwinner_qbo__Fully_Qualified_Name__c}" rendered="{!Contains(xA.breadwinner_qbo__Fully_Qualified_Name__c,':')}">
                                                    <p class="slds-truncate slds-m-left--x-large slds-m-top--x-small slds-text-body_regular" > This QuickBooks Online Company is a Sub Company. The full Company Hierarchy is {!xA.breadwinner_qbo__Fully_Qualified_Name__c} </p>
                                                </apex:outputPanel>
                                                <div class="slds-grid slds-m-top--small">

                                                    <div class="slds-m-left--x-large">
                                                        <p class="slds-truncate slds-m-bottom--xx-small"><b>Company Information:</b></p>
                                                        <div class="slds-text-body--regular slds-truncate">
                                                            <apex:outputPanel title="{!xA.breadwinner_qbo__Company_Name__c}" rendered="{!AND(NOT(ISBLANK(xA.breadwinner_qbo__Company_Name__c)),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Company_Name__c.accessible)}">
                                                                {!xA.breadwinner_qbo__Company_Name__c}
                                                                <br/>
                                                            </apex:outputPanel>

                                                            <apex:outputPanel title="{!xA.breadwinner_qbo__Street_Address__c}" rendered="{!AND(NOT(ISBLANK(xA.breadwinner_qbo__Street_Address__c)),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Street_Address__c.accessible)}">
                                                                {!xA.breadwinner_qbo__Street_Address__c}
                                                                <br/>
                                                            </apex:outputPanel>
                                                            <apex:outputPanel title="{!xA.breadwinner_qbo__City__c} {!xA.breadwinner_qbo__Region__c} {!xA.breadwinner_qbo__Postal_Code__c}" rendered="{!AND(OR(NOT(ISBLANK(xA.breadwinner_qbo__Region__c)),NOT(ISBLANK(xA.breadwinner_qbo__Postal_Code__c))),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__City__c.accessible,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Region__c.accessible,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Postal_Code__c.accessible)}">
                                                                {!xA.City__c},&nbsp;{!xA.Region__c}&nbsp;{!xA.Postal_Code__c}
                                                                <br/>
                                                            </apex:outputPanel>
                                                            <apex:outputPanel title="{!xA.breadwinner_qbo__Country__c}" rendered="{!AND(NOT(ISBLANK(xA.breadwinner_qbo__Country__c)),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Country__c.accessible)}">
                                                                {!xA.breadwinner_qbo__Country__c}
                                                            </apex:outputPanel>
                                                        </div>
                                                    </div>
                                                    <div class="slds-page-header__detail-block">
                                                        <p class="slds-truncate slds-m-bottom--xx-small"><b>Contact Info:</b></p>
                                                        <div class="slds-text-body--regular slds-truncate">
                                                            <apex:outputPanel title="{!xA.breadwinner_qbo__Given_Name__c}" rendered="{!AND(NOT(ISBLANK(xA.breadwinner_qbo__Given_Name__c)),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Given_Name__c.accessible)}" >
                                                                {!xA.breadwinner_qbo__Given_Name__c} <BR/>
                                                            </apex:outputPanel>
                                                            <apex:outputPanel title="{!xA.breadwinner_qbo__Email__c}" rendered="{!AND(NOT(ISBLANK(xA.breadwinner_qbo__Email__c)),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Email__c.accessible)}" >
                                                                {!xA.breadwinner_qbo__Email__c} <BR/>
                                                            </apex:outputPanel>
                                                            <apex:outputPanel title="{!xA.breadwinner_qbo__Phone_Number__c}" rendered="{!AND(NOT(ISBLANK(xA.breadwinner_qbo__Phone_Number__c)),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Phone_Number__c.accessible)}" >
                                                                {!xA.breadwinner_qbo__Phone_Number__c} <BR/>
                                                            </apex:outputPanel>
                                                        </div>
                                                    </div>
                                                    <apex:outputPanel styleClass="slds-page-header__detail-block"  rendered="{!AND(isMultiOrgEnabled,OR(NOT(ISBLANK(xA.breadwinner_qbo__QBO_Org_Name__c)),NOT(ISBLANK(appConfigMap[xA.breadwinner_qbo__QBO_Org_ID__c].Display_Name__c))),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__QBO_Org_Name__c.accessible)}">
                                                        <p class="slds-truncate slds-m-bottom--xx-small"><b>QuickBooks Online Org:</b></p>
                                                        <div class="slds-text-body--regular slds-truncate" title="{!IF(ISBLANK(appConfigMap[xA.breadwinner_qbo__QBO_Org_ID__c].Display_Name__c), xA.breadwinner_qbo__QBO_Org_Name__c, appConfigMap[xA.breadwinner_qbo__QBO_Org_ID__c].Display_Name__c)}">
                                                       {!IF(ISBLANK(appConfigMap[xA.breadwinner_qbo__QBO_Org_ID__c].Display_Name__c), xA.breadwinner_qbo__QBO_Org_Name__c, appConfigMap[xA.breadwinner_qbo__QBO_Org_ID__c].Display_Name__c)}
                                                        </div>
                                                        <apex:outputPanel rendered="{!NOT(ISBLANK(appConfigMap[xA.breadwinner_qbo__QBO_Org_ID__c].Logo_URL__c))}">
                                                         <apex:image style="height: 40px" url="{!appConfigMap[xA.breadwinner_qbo__QBO_Org_ID__c].Logo_URL__c}" />
                                                         </apex:outputPanel>                                                        
                                                    </apex:outputPanel>
                                                    <apex:outputPanel styleClass="slds-page-header__detail-block"  rendered="{!AND(isMultiCurrencyEnabled,Plan_Code>=35,NOT(ISBLANK(xA.breadwinner_qbo__Currency__c)),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Currency__c.accessible)}">
                                                        <p class="slds-truncate slds-m-bottom--xx-small"><b>Currency:</b></p>
                                                        <div class="slds-text-body--regular slds-truncate">
                                                            {!xA.breadwinner_qbo__Currency__c}
                                                        </div>
                                                    </apex:outputPanel>
                                                </div>
                                            </label>
                                        </apex:outputPanel>
                                    </apex:repeat>
                                </div>
                            </fieldset>

                        </div>
                        <!-- ----------------------------------------------------Select Customer End----------------------------------------------------------- -->
                        <script>                        
                            document.getElementById('{!JSENCODE(selectedQBOAccount)}').checked = true;                        
                            if({!(!isAllowedToCreateBAC)}){
                                document.getElementById('createNewAccount').checked = false;                        
                                document.getElementById('createNewAccount').disabled = true;
                            }

                        </script>
                        <script>
                            function pushselectedQBOAccount(refId) {
                                document.getElementById('{!JSENCODE($Component.theForm.selectedQBOAccount)}').value = refId;
                            }
                        </script>
                        <apex:inputHidden id="selectedQBOAccount" value="{!selectedQBOAccount}" />
                        <div style="text-align:center;">
                            <apex:commandButton value="Next" action="{!next}" disabled="{!AND(NOT(isAllowedToCreateBAC),OR(NOT(isAllowedToCreateOrUpdateInvoice),AND(isAllowedToCreateOrUpdateInvoice,selectedAccount.QBO_Companies__r.size==0)))}" status="assign-action-status" styleClass="slds-button slds-button--brand slds-m-top--medium" />
           
                            <apex:commandButton value="Cancel" action="{!cancel}" onclick="return window.confirm('Are you sure?');" styleClass="slds-button slds-button--neutral slds-m-top--medium" />
                        </div>
                            </apex:outputPanel>
                    </apex:outputPanel>

                    <apex:outputPanel id="accountPanel" rendered="{!AND(showAccountPanel,OR($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.createable,AND(isEditAccount,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.updateable)))}">
                        <apex:outputPanel rendered="{!AND(OR(AND($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.createable,ISNULL(sfAccountChild.Id)),AND(isEditAccount,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.updateable)))}">
                        <apex:actionFunction reRender="displaynameid" name="DisplayName"/>
                        <script type="text/javascript">
                            var j$ = jQuery.noConflict();
                            HideStyleSheet(); message();
                            function changeTheContact(firstname, lastname, email) {
                                j$('input[id$=confirstname]').val(firstname);
                                j$('input[id$=conlastname]').val(lastname);
                                j$('input[id$=email]').val(email);
                                DisplayName();
                            }
                        </script>
                        
                        
                        <!-- ----------------------------------------------------Page Header Start----------------------------------------------------------- -->
                        <div class="slds-page-header slds-m-bottom--medium" role="banner">
                            <div class="slds-media slds-media--center">
                                <div class="slds-media__figure">
                                    <svg aria-hidden="true" class="slds-icon slds-icon-standard-user">
                                        <use xlink:href="{!URLFOR($Resource.Breadwinner_QBO, 'Breadwinner_QBO/SLDS/assets/icons/standard-sprite/svg/symbols.svg#account')}"></use>
                                    </svg>
                                </div>
                                <div class="slds-media__body">
                                  <p class="slds-text-title--caps slds-line-height--reset" style='display:{!IF(OR(isEditAccount,isAtQBOModify),"block","none")}'>Editing</p> <h1 class="slds-page-header__title slds-m-right--small slds-align-middle slds-truncate" title="{!if(OR(isEditAccount,isAtQBOModify),bacName,"New QuickBooks Online Customer")}" style='font-size:1.6em'>{!if(OR(isEditAccount,isAtQBOModify),bacName,"New QuickBooks Online Customer")}</h1>

                                </div>
                            </div>
                        </div>
                         <apex:pageMessage summary="You are using Breadwinner in QuickBooks Online Read Only Mode. While Breadwinner reads data from QuickBooks Online, no changes will be made to QuickBooks Online. QuickBooks Online is in Read-Only mode and will not be altered in any way." severity="Info" rendered="{!isReadOnlyMode}"/>
                         <apex:pageMessage rendered="{!isOAuthIssue}" escape="false" detail="{!oAuthExceptionWarningMessage}" summary="There was a problem with the connection to QuickBooks Online:" severity="WARNING" strength="3"/>
                        <div class="errorM3" style='display:{!IF(AND(isAtQBO,NOT(isatQBOModify)),"block","none")}'>
                            A QuickBooks Online Company already exists with this exact Display Name at QuickBooks Online<div style='display:{!IF(isEditAccount,"initial","none")}'> but not yet synced into Salesforce</div>.<div style='display:{!IF(isEditAccount,"none","block")}'>As QuickBooks Online Company with this exact Display Name is not yet synchronized into salesforce by Breadwinner. You can<apex:commandLink action="{!getQBOCustomerResponse}" value="refresh data from QuickBooks Online and then you can modify" >
                              </apex:commandLink>
                            or else you can create with different Display Name.</div>                        
                         </div>                          
                        <apex:outputPanel rendered="{!AND(NOT(isAtQBO),OR(NOT(ISBLANK(exceptionMessageOnCustomerCreation)),AND(NOT(ISBLANK(dupBAC.breadwinner_qbo__Salesforce_Account__c)),OR((dupBAC.breadwinner_qbo__Salesforce_Account__c !=selectedAccount.Id),(dupBAC.breadwinner_qbo__Salesforce_Account__c =selectedAccount.Id)))))}" id="pmgspanel">                        
                            <apex:pageMessage summary="{!IF(CONTAINS(exceptionMessageOnCustomerCreation,'Inactive at QuickBooks Online'),"Warning","Error")} " detail="{!exceptionMessageOnCustomerCreation}" rendered="{!AND(NOT(ISBLANK(exceptionMessageOnCustomerCreation)),ISBLANK(dupBAC.breadwinner_qbo__Salesforce_Account__c))}"  severity="{!IF(CONTAINS(exceptionMessageOnCustomerCreation,'Inactive at QuickBooks Online'),"Warning","ERROR")}" strength="3" escape="false"/>
                            <div class="{!IF(CONTAINS(exceptionMessageOnCustomerCreation,'Inactive at QuickBooks Online'),"warningM3","errorM3")}" style='display:{!IF(AND(NOT(ISBLANK(dupBAC.Salesforce_Account__c)),OR((dupBAC.Salesforce_Account__c !=selectedAccount.Id),(dupBAC.Salesforce_Account__c =selectedAccount.Id))),"block","none")}'>
                                <apex:outputPanel rendered="{!AND(NOT(ISBLANK(dupBAC.breadwinner_qbo__Salesforce_Account__c)),(dupBAC.breadwinner_qbo__Salesforce_Account__c !=selectedAccount.Id))}" style="text-align:left">
                                <div >Error:<br/> 
                                    <div class='slds-m-left--large'>
                                        A QuickBooks Online Company with the same Display Name already exists and is related to the Salesforce Account:
                                         <a href="/{!dupBAC.Salesforce_Account__c}" target="_blank">{!dupBAC.Salesforce_Account__r.name}</a>. <br/> 
                                         You may wish to create a new QuickBooks Online Company by giving it a different Display Name.
                                   </div>
                               </div>
                              </apex:outputPanel>   
                             <apex:outputPanel rendered="{!(dupBAC.breadwinner_qbo__Salesforce_Account__c ==selectedAccount.Id)}" style="text-align:left">
                                <div >Error:<br/>
                                    <div class='slds-m-left--large'>
                                     A QuickBooks Online Company with the same Display name already exists and is related to the current Salesforce Account 
                                     <a href="/{!selectedAccount.Id}" target="_blank">{!selectedAccount.Name}</a>.<br/> 
                                     You can either create a new QuickBooks Online Company by giving it a different Display Name or choose the existing QuickBooks Online Company in the previous page.
                                    </div>
                                </div>
                             </apex:outputPanel>   
                            </div>
                        </apex:outputPanel>                             
                        <apex:pageMessage summary="Insufficient Access" severity="WARNING" strength="3" rendered="{!AND(isEditAccount, NOT(isAllowedToUpdateBAC))}">
                             You can create an Invoice under existing QuickBooks Online Companies but your current Salesforce Permissions do not allow you to create a new QuickBooks Online Company. If you need to update this QuickBooks Online Company, Please ask your Salesforce Administrator to give you the "Breadwinner Full User" permission set. <a target="{!IF(OR($User.UIThemeDisplayed = 'Theme4d',$User.UIThemeDisplayed = 'Theme4t'),'','_blank')}" href="{!breadwinnerSupportPortalURL}/customer/en/portal/articles/2438620-breadwinner-security-and-permissions---adding-users-to-breadwinner?b_id=9335" style="color: black">Instructions</a>.
                        </apex:pageMessage>
                        <!-- ----------------------------------------------------Page Header END----------------------------------------------------------- -->
                        <div class="slds-grid slds-wrap slds-m-top--large">
                          <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!if(AND(isMultiCurrencyEnabled,Plan_Code<35),"block","none")};">  
                                <font color="red">
                                Breadwinner Basic edition does not support QuickBooks Online Multi-Currency.<br/> You can create a QuickBooks Online Company using this page, but the new company will have the currency set to your default QuickBooks Online Currency and this can not be changed later due to QuickBooks Online limitations.<br/> If you want to create a new QuickBooks Online Company using your non-default currency, we recommend you either upgrade to Breadwinner Professional or create this QuickBooks Online Company directly in QuickBooks Online
                                </font>
                            </div>
                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-3 slds-large-size--1-of-3" >
                                <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small"  style="display:{!if(AND(isMultiOrgEnabled,$ObjectType.Breadwinner_Account_Connection__c.fields.QBO_Org_Name__c.accessible),"block","none")};">  
                                    <div class="slds-form-element">
                                        <span class="slds-form-element__label">QuickBooks Online Org Name</span>
                                        <div class="slds-form-element__control">
                                           <apex:selectList value="{!selectedQBOOrgID}" multiselect="false" size="1"  styleClass="slds-input" disabled="{!OR(isEditAccount,isAtQBOModify)}">
                                               <apex:actionSupport event="onchange" action="{!onchangeQBOCompany}"  rerender="accountPanel,pmg" status="spinnerimg"/>
                                                <apex:selectOptions value="{!orgsList}"/>                                                                
                                           </apex:selectList> 
                                        </div>
                                    </div>
                                    <apex:actionstatus id="spinnerimg">
                                        <apex:facet name="start">
                                            <div class="slds-spinner_container">
                                              <div class="slds-spinner--brand slds-spinner slds-spinner--large" role="alert">
                                                <span class="slds-assistive-text">Loading</span>
                                                <div class="slds-spinner__dot-a"></div>
                                                <div class="slds-spinner__dot-b"></div>
                                              </div>
                                            </div>
                                        </apex:facet>
                                    </apex:actionstatus>

                                 </div>
                                <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF(OR($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Given_Name__c.createable,AND(isEditAccount,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Given_Name__c.updateable)),'','none')}">
                                    <div class="slds-form-element">
                                        <span class="slds-form-element__label">{!$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Given_Name__c.label}</span>
                                        <div class="slds-form-element__control">
                                            <apex:inputtext value="{!sfAccountChild.breadwinner_qbo__Given_Name__c}" styleClass="slds-input" id="confirstname" >
                                               <apex:actionSupport event="onchange" reRender="displaynameid" />
                                            </apex:inputtext>
                                            
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF(OR($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Family_Name__c.createable,AND(isEditAccount,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Family_Name__c.updateable)),'','none')}">
                                    <div class="slds-form-element">
                                        <span class="slds-form-element__label">{!$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Family_Name__c.label}</span>
                                        <div class="slds-form-element__control">
                                            <apex:inputtext value="{!sfAccountChild.breadwinner_qbo__Family_Name__c}" rendered="{!$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Family_Name__c.createable}" styleClass="slds-input" id="conlastname" >
                                                 <apex:actionSupport event="onchange" reRender="displaynameid" />
                                            </apex:inputtext>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF(OR($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Company_Name__c.createable,AND(isEditAccount,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Company_Name__c.updateable)),'','none')}">
                                    <div class="slds-form-element">
                                        <span class="slds-form-element__label">{!$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Company_Name__c.label}</span>
                                        <div class="slds-form-element__control">
                                            <apex:inputtext value="{!sfAccountChild.breadwinner_qbo__Company_Name__c}" styleClass="slds-input" id="companyName" >
                                                <apex:actionSupport event="onchange" reRender="displaynameid" />
                                            </apex:inputtext>
                                        </div>
                                    </div>
                                </div>
                       <!---         <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small">
                                    <div class="slds-form-element">
                                        <span class="slds-form-element__label">
                                                <abbr class="slds-required" title="required">*</abbr> {!$ObjectType.Breadwinner_Account_Connection__c.fields.Display_Name__c.label}
                                            </span>
                                        <div class="slds-form-element__control">                               
                                            <apex:inputtext value="{!sfAccountChild.breadwinner_qbo__Display_Name__c}" rendered="{!$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Display_Name__c.createable}" styleClass="slds-input" /> 
                                        </div>
                                    </div>
                                </div>   ---->
                                
                                 <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF(OR($ObjectType.Breadwinner_Account_Connection__c.fields.Display_Name__c.createable,AND(isEditAccount,$ObjectType.Breadwinner_Account_Connection__c.fields.Display_Name__c.updateable)),'','none')}">
                                    <div class="slds-form-element">
                                        <span class="slds-form-element__label">
                                                <abbr class="slds-required" title="required">*</abbr> {!$ObjectType.Breadwinner_Account_Connection__c.fields.Display_Name__c.label}
                                         </span>
                                        <div class="slds-form-element__control">
                                        <apex:outputPanel id="displaynameid" styleClass="select-editable" rendered="{!NOT(isatQBOModify)}">
                                            <select onchange="this.nextElementSibling.value=this.value" onfocus="j$(this).parent().addClass('divfocus')" onblur="j$(this).parent().removeClass('divfocus')" >
                                                <option style="display:{!IF(AND(sfAccountChild.Company_Name__c!=null,sfAccountChild.Company_Name__c == sfAccountChild.Display_Name__c),'','none')}" selected ="{!IF(sfAccountChild.Company_Name__c == sfAccountChild.Display_Name__c,'selected','')}"> {!sfAccountChild.breadwinner_qbo__Display_Name__c} </option>
                                                <option style="display:{!IF(AND(sfAccountChild.Company_Name__c!=null,sfAccountChild.Company_Name__c != sfAccountChild.Display_Name__c,OR(sfAccountChild.Company_Name__c== sfAccountChild.Given_Name__c,sfAccountChild.Company_Name__c == sfAccountChild.Family_Name__c,TRUE)),'','none')}"> {!sfAccountChild.breadwinner_qbo__Company_Name__c} </option>
                                                <option style="display:{!IF(AND(sfAccountChild.Given_Name__c != null, sfAccountChild.Family_Name__c == null,sfAccountChild.Company_Name__c!= sfAccountChild.Given_Name__c),'','none')}"> {!sfAccountChild.breadwinner_qbo__Given_Name__c} </option>
                                                <option style="display:{!IF(AND(sfAccountChild.Given_Name__c == null, sfAccountChild.Family_Name__c!= null,sfAccountChild.Company_Name__c != sfAccountChild.Family_Name__c ),'','none')}"> {!sfAccountChild.breadwinner_qbo__Family_Name__c} </option>  
                                                <option style="display:{!IF(AND(sfAccountChild.Given_Name__c != null, sfAccountChild.Family_Name__c!= null ),'','none')}"> {!sfAccountChild.breadwinner_qbo__Given_Name__c} {!sfAccountChild.breadwinner_qbo__Family_Name__c}</option>
                                                <option style="display:{!IF(AND(sfAccountChild.Given_Name__c != null, sfAccountChild.Family_Name__c!= null ),'','none')}"> {!sfAccountChild.breadwinner_qbo__Family_Name__c}, {!sfAccountChild.breadwinner_qbo__Given_Name__c} </option>
                                            </select>
                                            <apex:inputtext html-autocomplete="off" rendered="{!$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Display_Name__c.createable}" value="{!sfAccountChild.breadwinner_qbo__Display_Name__c}" onfocus="j$(this).parent().addClass('divfocus')" onblur="j$(this).parent().removeClass('divfocus')" />                      
                                        </apex:outputPanel>
                                        <apex:inputtext html-autocomplete="off" rendered="{!AND($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Display_Name__c.createable,isatQBOModify)}" value="{!sfAccountChild.breadwinner_qbo__Display_Name__c}" styleClass="slds-input" disabled="true" />
                                       </div>
                                    </div>
                                </div>
                                <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF(OR($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Street_Address__c.createable,AND(isEditAccount,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Street_Address__c.updateable)),'','none')}">
                                    <div class="slds-form-element">
                                        <span class="slds-form-element__label">{!$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Street_Address__c.label}</span>
                                        <div class="slds-form-element__control">
                                            <apex:inputTextarea value="{!sfAccountChild.breadwinner_qbo__Street_Address__c}" cols="22" rows="3" styleClass="slds-input" />
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF(OR($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__City__c.createable,AND(isEditAccount,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__City__c.updateable)),'','none')}">
                                    <div class="slds-form-element">
                                        <span class="slds-form-element__label">{!$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__City__c.label}</span>
                                        <div class="slds-form-element__control">
                                            <apex:inputtext value="{!sfAccountChild.breadwinner_qbo__City__c}" styleClass="slds-input" />
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF(OR($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Region__c.createable,AND(isEditAccount,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Region__c.updateable)),'','none')}">
                                    <div class="slds-form-element">
                                        <span class="slds-form-element__label">{!$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Region__c.label}</span>
                                        <div class="slds-form-element__control">
                                            <apex:inputtext value="{!sfAccountChild.breadwinner_qbo__Region__c}" styleClass="slds-input" />
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF(OR($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Postal_Code__c.createable,AND(isEditAccount,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Postal_Code__c.updateable)),'','none')}">
                                    <div class="slds-form-element">
                                        <span class="slds-form-element__label">{!$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Postal_Code__c.label}</span>
                                        <div class="slds-form-element__control">
                                            <apex:inputtext value="{!sfAccountChild.breadwinner_qbo__Postal_Code__c}" styleClass="slds-input" />
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF(OR($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Country__c.createable,AND(isEditAccount,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Country__c.updateable)),'','none')}">
                                    <div class="slds-form-element">
                                        <span class="slds-form-element__label">{!$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Country__c.label}</span>
                                        <div class="slds-form-element__control">
                                            <apex:inputtext value="{!sfAccountChild.breadwinner_qbo__Country__c}" styleClass="slds-input" />
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF(OR($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Email__c.createable,AND(isEditAccount,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Email__c.updateable)),'','none')}">
                                    <div class="slds-form-element">
                                        <span class="slds-form-element__label">{!$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Email__c.label}</span>
                                        <div class="slds-form-element__control">
                                            <apex:inputtext value="{!sfAccountChild.breadwinner_qbo__Email__c}" styleClass="slds-input" id="conemail" />
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF(OR($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Default_Payment_Method_Ref__c.createable,AND(isEditAccount,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Default_Payment_Method_Ref__c.updateable)),'','none')}">
                                    <div class="slds-form-element">
                                        <span class="slds-form-element__label">Preferred Payment Method</span>
                                        <div class="slds-form-element__control">
                                            <apex:selectList value="{!sfAccountChild.breadwinner_qbo__Default_Payment_Method_Ref__c}" size="1" styleClass="slds-input">
                                                <apex:selectOption value="{!null}" />
                                                <apex:selectOptions value="{!paymentMethodList}" />
                                            </apex:selectList>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF(OR($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Default_Terms_Ref__c.createable,AND(isEditAccount,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Default_Terms_Ref__c.updateable)),'','none')}">
                                    <div class="slds-form-element">
                                        <span class="slds-form-element__label">Terms</span>
                                        <div class="slds-form-element__control">
                                            <apex:selectList value="{!sfAccountChild.breadwinner_qbo__Default_Terms_Ref__c}" size="1" styleClass="slds-input">
                                                <apex:selectOption value="{!null}" />
                                                <apex:selectOptions value="{!termsList}" />
                                            </apex:selectList>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF(AND(isMultiCurrencyEnabled,OR($ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Currency__c.createable,AND(isEditAccount,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Currency__c.updateable))),'','none')}">
                                    <apex:outputPanel >
                                        <div class="slds-form-element">
                                            <span class="slds-form-element__label">
                                                <abbr class="slds-required" title="required">*</abbr> Default Currency
                                            </span>
                                        <div class="slds-form-element__control">
                                                <apex:selectList value="{!sfAccountChild.breadwinner_qbo__Currency__c}" size="1" styleClass="slds-input" disabled="{!if(OR(Plan_Code<35,isEditAccount,isAtQBOModify),true,false)}">
                                                    <apex:selectOption value="{!null}"/>
                                                    <apex:selectOptions value="{!multiCurrencylist}" />
                                                </apex:selectList>  
                                            </div>
                                            
                                        </div>
                                    </apex:outputPanel>
                                </div>
                            </div>
                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--2-of-3 slds-large-size--2-of-3 slds-m-top--large">
                                <div style="display: {!IF(OR(isEditAccount,isAtQBOModify),"none","block")}">
                                <p>
                                    <b>The Company Name and Address is populated from the Salesforce Account <i>"{!selectedAccount.Name}"</i>, using Account Name and Billing Address.</b>
                                </p>
                                <p>
                                    <b>Optionally, you can populate the fields First Name, Last Name, and Email from a Contact on the Account.</b>
                                </p>
                                </div>
                                <div style="display: {!IF(OR(isEditAccount,isAtQBOModify),"block","none")}"> <b>You can populate the fields First Name, Last Name, and Email on the QuickBooks Online Customer from one of the Salesforce Contacts below.</b></div>
                                <font color="red">
                                    <apex:outputText rendered="{!contactWrapperList.size==0}">No Salesforce Contacts exist for this Salesforce Account</apex:outputText>
                                </font>
                                <div class="slds-m-top--medium" style="display:{!IF(AND($ObjectType.Contact.accessible,OR($ObjectType.Contact.fields.firstname.accessible,$ObjectType.Contact.fields.lastname.accessible,$ObjectType.Contact.fields.Email.accessible)),'','none')}">

                                    <apex:repeat value="{!contactWrapperList}" var="con">
                                        <div class="slds-form-element__control slds-m-top--small">
                                            <label class="slds-radio">
                                                <input type="radio" name="SalesforceContact" id="{!con.ContactId}" value="{!con.ContactId}" onchange="changeTheContact('{!con.firstname}','{!con.lastname}', '{!con.Email}');" />
                                                <span class="slds-radio--faux"></span>
                                                <span class="slds-form-element__label" for="{!con.ContactId}">{!con.textToDisplay}</span>
                                            </label>
                                        </div>
                                    </apex:repeat>
                                </div>
                                <script>
                                    document.getElementById('{!selectedContactWrapperRecord.ContactId}').checked = {!!isEditAccount};
                                </script>
                            </div>
                        </div>
                        <div align='center'  style="display:{!if((syncSalesReceiptsEnabled==false)&&(createSalesReceipt),"block","none")};">
                              <div style='color:red'> You are creating this QuickBooks Online Company in a QuickBooks Online Org that Breadwinner has been configured to sync Invoices but not Sales Receipts.</div><br/>
                              <div style='color:red'>You can create this QuickBooks Online Company but you cannot create Sales Receipts for it, only Invoices.</div>
                        </div>
                        </apex:outputPanel>
                         <div  style="text-align:center;" class="slds-m-bottom--large">
                            <apex:commandButton disabled="{!IF(OR(AND(isEditAccount,NOT(sfAccountChild.breadwinner_qbo__Active__c)),isOAuthIssue,isReadOnlyMode),true,false)}" value="{!if(OR(isEditAccount,isAtQBOModify),'Save and Proceed to '+IF(createSalesReceipt,'Sales Receipt','Invoice')+' Creation','Create QuickBooks Online Customer')}" onclick="upsertQBOAccount(); this.disabled=true; this.value='{!IF(OR(isEditAccount,isAtQBOModify),"Updating...","Creating...")}'; return false;" rendered="{!OR(AND(isEditAccount,isAllowedToUpdateBAC),isAllowedToCreateBAC)}" styleClass="slds-button slds-button--brand slds-m-top--medium" reRender="" />
                            <apex:commandButton value="Cancel" action="{!cancel}" onclick="return window.confirm('Are you sure?');" styleClass="slds-button slds-button--neutral slds-m-top--medium" />
                           <apex:actionFunction name="upsertQBOAccount" action="{!upsertQBOAccount}" reRender="" oncomplete="redirectToCreateInvoice();" status="actioin_status"/>
                            <apex:actionFunction name="redirectToCreateInvoice" action="{!redirectToCreateInvoice}"  status="actioin_status">
                                 <apex:param name="selectedQBOOrgID" value="{!selectedQBOOrgID}" assignTo="{!selectedQBOOrgID}" />
                            </apex:actionFunction>
                             <apex:outputPanel layout="block" styleclass="slds-text-heading--small slds-m-top--small" style="font-weight: bold;font-style: italic;" rendered="{!isReadOnlyMode}">You are using Breadwinner in QuickBooks Online Read Only Mode. While Breadwinner reads data from QuickBooks Online, no changes will be made to QuickBooks Online. QuickBooks Online is in Read-Only mode and will not be altered in any way.</apex:outputPanel>
                        </div>
                    </apex:outputPanel>
                </apex:outputPanel>
                
            </div>
        </apex:form>
    </body>

    </html>
</apex:page>