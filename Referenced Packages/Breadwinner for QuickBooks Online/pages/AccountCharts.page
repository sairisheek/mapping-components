<apex:page standardController="Account" extensions="breadwinner_qbo.AccountChartsExtension" action="{!initialize}" sidebar="false" showHeader="false">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
     <style>
    
    #chartDivId ul{list-style-type: none;}
    #chartDivId li{display: inline-block; list-style-type: none; }
    .content{padding:15px 15px 15px 30px; margin-left:20px; border-left:2px solid #666; }
    .labelHeading{font-size:20px; display:block; margin-bottom:10px;}
    .orgStatus{ padding:0px; display:block;}
    
    #invoiceInfoTable{width:200px;}
    .rightText{ text-align:right;}
    .leftText{ text-align:left;}
    .trialTxt{font-size: 12px; text-align:center; }
    #invoiceInfoTable td{padding:5px; background: #f1f1f1;border-bottom: 1px solid #fff;}
    .gaugeChartText{font-size: 11px;width: 200px; margin-top:-10px;}
    #piechart_3d div[dir*='ltr']{height: 150px !important;;}
    .pieChart3dTitle{font-size: 11px;font-weight: bold;}
    
    @media screen and (max-width: 550px) {
       #chartDivId > tbody > tr,  #chartDivId > tbody, #chartDivId{display:block;}
       #chartDivId > tbody > tr > td{display:block;}
       #piechart_3d,  #chart_div{width:142px; margin:0 auto;}
       #bar_chart_div{width: 393px;margin: 0 auto;}
       .trialTxt{text-align: center; font-size: 12px; position: relative;}
       .gaugeChart{ text-align:center;}
       .invoiceTable{padding:22px 15px;}
       .barChart{padding-bottom:20px;}
       #invoiceInfoTable{width:100%;}
       .gaugeChartText{font-size: 11px;margin-top:0;width:auto;}
    }
    .message {
        padding : 0px;
        border-style: none;
        margin: 4px 2px;
    }
    </style>

    <!--script type="text/javascript" src="https://www.google.com/jsapi"></script-->
    <apex:includeScript value="{!URLFOR($Resource.breadwinner_qbo__Breadwinner_QBO, 'Breadwinner_QBO/JS/jsapi.js')}" />
    <script src="{!URLFOR($Resource.Breadwinner_QBO,'Breadwinner_QBO/JS/jquery-1.11.3.js')}"></script> 
    <script type="text/javascript">
                    var j$ = jQuery.noConflict();

      google.load("visualization", "1", {packages:["corechart", "gauge", "bar"]});
      google.setOnLoadCallback(drawChart);
      
      function drawChart() {
                    
            var jsonDataTotalInvoicesBilled = {!SUBSTITUTE(JSENCODE(jsonTotalBilledPieChartData), '\\', '') };
            var pie_chart_data = new google.visualization.DataTable(jsonDataTotalInvoicesBilled);
            
            var pie_chart_options = {
                //title: '{!JSENCODE(totalBilledPieChartTitle)}',
              //titleTextStyle: {  fontSize: 11 },
              width: 200,
              height: 200,             
              is3D: true,
              colors: ['green', 'orange', 'red'],              
              legend: { position: 'none' },
              chartArea:{top:13}
            };
           
            var gaugeData = {!JSENCODE(longestOverDueGaugeChartData)};
            var guage_data = google.visualization.arrayToDataTable([
              ['Label', 'Value'],
              ['Days', gaugeData ],
            ]);

            var guage_options = {
              width: 130, height: 130,
              max: 90,
              redFrom: 30, redTo: 90,
              yellowFrom:0, yellowTo: 30,
              majorTicks: [0,30,60,90],
              minorTicks: 5,
              chartArea:{top:50}
            };
            
            var barChartData = {!SUBSTITUTE(JSENCODE(barChartData), '\\', '') };
            var bar_chart_data = new google.visualization.DataTable(barChartData);
            
            var bar_chart_options = {
                
                width:450,
                height:190,
                legend: { position: 'bottom' },
                bar: { groupWidth: '50%' },
                isStacked: true,
                colors: ['green','orange', '#dc3912','#B0C4DE'],
                chartArea:{righ:0,top:20}

              };
              if({!IF(noBarChartData,true,false)}){
                  bar_chart_options.vAxis= {minValue : 1000};
              }

        var pie_chart = new google.visualization.PieChart(document.getElementById('piechart_3d'));
        pie_chart.draw(pie_chart_data, pie_chart_options); 
       
        var guage_chart = new google.visualization.Gauge(document.getElementById('chart_div'));
        guage_chart.draw(guage_data, guage_options);
        
        var bar_chart = new google.visualization.ColumnChart(document.getElementById('bar_chart_div'));
        bar_chart.draw(bar_chart_data, bar_chart_options);
        //Centre Total billed if Multi currency Enabled
        if({!isMultiCurrency})
         j$( "div#piechart_3d text:nth-child(1)" ).attr( "x","30");

      }
      
      window.onresize = drawChart;
    </script>

  </head>
  <body>
    <apex:pageMessages ></apex:pageMessages>
    <apex:outputPanel rendered="{!daysOverdue>0}">
      <apex:outputPanel rendered="{!OR(isAdministrator, daysOverdue > 7)}">
        <apex:pageMessage severity="{!daysOverdueSeverity}" summary="{!summaryMessage}" strength="{!IF(daysOverdue > 8, 3, IF(daysOverdue >3, 2, 1))}" />
      </apex:outputPanel>
    </apex:outputPanel>
     <div align="center" style ="{!IF(OR(AND(isExpired,NOT(isOrgOutOfSync)),OR(NOT(isScheduledJobsRunbyActiveUser),NOT(isScheduledJobsRunbyAdmin))),'background:#FCC;', 'background:#FFFFCC;')}  layout:block; line-height:{!HTMLENCODE(lineHeight)};">     
      <apex:outputPanel rendered="{!AND(OR(isScheduledJobsRunbyActiveUser,isScheduledJobsRunbyAdmin),nodOfDaysLeft > -61, NOT(ISBLANK(expirationText)) )}" styleClass="trialTxt" style ="background:{!IF(isExpired,'','#FFFFCC;')}" layout="block">
          {!expirationText} 
          <apex:outputPanel rendered="{!AND(NOT(isSandbox),NOT(isDeveloperOrg))}"> Please&nbsp;
              <apex:outputLink value="{!paymentPageURL}" target="_blank">Click Here to start your subscription</apex:outputLink>.
          </apex:outputPanel>              
      </apex:outputPanel>
      <apex:outputPanel rendered="{!isOrgOutOfSync}" style="{!HTMLENCODE(outOfSyncStyle)}">
                 Please reset your connection to Quickbooks Online <apex:outputText value="{!outOfSyncOrg}"/> by clicking "reconnect" in Step 2 in the <a href="{!URLFOR($Page.breadwinner_qbo__Breadwinner)}" target="{!IF(OR($User.UIThemeDisplayed == 'Theme4d',$User.UIThemeDisplayed == 'Theme4t'),'','_blank')}" >Breadwinner tab</a>. <a href="{!breadwinnerSupportPortalURL}/customer/portal/articles/2065332-reset-reconnect-your-connection-to-xero-quickbooks-online" target="_blank">
                 <apex:outputtext style="font-size:12px;"> Instructions</apex:outputtext></a>.
       </apex:outputPanel>
         <apex:outputPanel rendered="{!NOT(isOrgOutOfSync)}">
             <apex:outputPanel rendered="{!OR(NOT(isScheduledJobsRunbyActiveUser),NOT(isScheduledJobsRunbyAdmin))}" styleClass="trialTxt">
              Breadwinner scheduled jobs are running under {!IF(NOT(isScheduledJobsRunbyActiveUser),'an Inactive User',IF(NOT(isScheduledJobsRunbyAdmin),'Non Administrator','an Inactive User or Non Administrator'))}.
              <apex:outputPanel rendered="{!isAdministrator}"> 
                Visit the&nbsp;<a target="{!IF(OR($User.UIThemeDisplayed == 'Theme4d',$User.UIThemeDisplayed == 'Theme4t'),'','_blank')}" href="{!URLFOR($Page.breadwinner_qbo__Breadwinner)}">Troubleshooting page
                </a> to fix this.
              </apex:outputPanel>
              <apex:outputPanel rendered="{!NOT(isAdministrator)}"> 
                Please contact your administrator to fix this.
              </apex:outputPanel>
            </apex:outputPanel>         
            
            <apex:outputPanel rendered="{!AND(OR(isScheduledJobsRunbyActiveUser,isScheduledJobsRunbyAdmin),ISBLANK(expirationText),NOT(ISBLANK(alertMessage)))}">
                {!alertMessage}
                <apex:outputLink target="_blank" value="{!URLFOR($Page.breadwinner_qbo__Breadwinner)}">click here
                </apex:outputLink> to know more.
            </apex:outputPanel>
            </apex:outputPanel>
     </div>
     <apex:outputPanel rendered="{!isInvoicePresent}">
        <table id="chartDivId" cellpadding="0" cellspacing="0" border="0" width="100%">
            
            <tr>
            <td class="pieChart3d">
                <div style="text-align:center;text-align: -webkit-center;text-align: -moz-center;">
                    
                    <p class="pieChart3dTitle">
                        <apex:outputLabel value="{!totalBilledPieChartTitle}"></apex:outputLabel>
                    </p>
                    
                    <div id="piechart_3d"></div>
                </div>
            </td>
            <td class="gaugeChart" >
                <div style="text-align:center;text-align: -webkit-center;text-align: -moz-center;margin-right: 20%;">
               
                    <p class="gaugeChartText">
                        <apex:outputLabel value="{!longestOverDueGaugeChartTitle}"></apex:outputLabel>
                    </p>
                    
                    <div id="chart_div"></div>
                </div>
                
            </td>
            <td class="invoiceTable">
                <table id="invoiceInfoTable" cellpadding="0" cellspacing="0" border="0" width="100%">
                    <tr>
                        <td>{!invoiceInfo.noOfOverdueInvoice}</td>
                        <td>
                            Invoices Overdue:
                        </td>
                        <td class="rightText">
                            <apex:outputPanel >
                            {!invoiceInfo.amountOverdue}
                            </apex:outputPanel>
                        </td>
                    </tr>
                    <tr>
                        <td>{!invoiceInfo.noOfDueInvoice}</td>
                        <td> 
                            Invoices Due:
                        </td>
                        <td class="rightText">
                            <apex:outputPanel >
                            {!invoiceInfo.amountDue}
                            </apex:outputPanel>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            {!invoiceInfo.noOfFullyPaidInvoice}
                        </td>
                        <td>
                            Invoices Fully Paid:
                        </td>
                        <td class="rightText">
                            <apex:outputPanel >
                            {!invoiceInfo.amountFullyPaid}
                            </apex:outputPanel>                                    
                        </td>
                    </tr>
                    <apex:outputPanel rendered="{!invoiceInfo.isSalesReceipt}">
                      <tr>
                          <td>
                              {!invoiceInfo.noOfSalesReceipts}
                          </td>
                          <td>
                              Sales Receipts :
                          </td>
                          <td class="rightText">
                              <apex:outputPanel >
                              {!invoiceInfo.amountSalesReceipts}
                              </apex:outputPanel>                                    
                          </td>
                      </tr>
                    </apex:outputPanel>
                </table>
                <div>
                  <apex:outputLabel style="{!IF(isMultiCurrency,'','padding-left:25%;')}" value="{!IF(isMultiCurrency==true, 'Amounts are in Multiple Currencies','Amounts in '+CurrencyCode)}"/>
                </div>
            </td>
            <td class="barChart">
                <div id="bar_chart_div"></div>
            </td>
            </tr>
        </table>
    </apex:outputPanel>
    
    <apex:outputpanel rendered="{!!isInvoicePresent}">
    <div style="font-size: 20px;margin-bottom: 10px;text-align: center;padding-top: 20px;">
      {!noInvoiceMessageHeading}
    </div>
    <div style="font-size: 13px;margin-bottom: 10px;text-align: center;">
      {!noInvoiceMessageSubHeading}
    </div>    
    </apex:outputpanel>
  
  </body>
</apex:page>