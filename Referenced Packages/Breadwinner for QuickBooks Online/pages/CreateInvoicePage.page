<apex:page sidebar="false" standardcontroller="breadwinner_qbo__Invoice__c" extensions="breadwinner_qbo.CreateInvoiceExtension" action="{!updateLineItems}" docType="html-5.0" id="pg" title="New QuickBooks Online {!IF(createSalesReceipt,'Sales Receipt', 'Invoice')}">
    <apex:form id="theForm">
        <apex:inputHidden id="missingLineItemMap" value="{!missingLineItemString}"/>
        <html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            
            <head>
                <apex:stylesheet value="{!URLFOR($Resource.breadwinner_qbo__Breadwinner_QBO, 'Breadwinner_QBO/SLDS/assets/styles/salesforce-lightning-design-system-vf.min.css')}" />
                
                <script src="{!URLFOR($Resource.Breadwinner_QBO, 'Breadwinner_QBO/JS/jquery-1.11.3.js')}"></script>
                <script src="{!URLFOR($Resource.Breadwinner_QBO, 'Breadwinner_QBO/JS/CreateInvoiceJS.js')}"></script>
                <script src="{!URLFOR($Resource.Breadwinner_QBO, 'Breadwinner_QBO/JS/select2.full.min.js')}"></script>
                <link rel="stylesheet" href="{!URLFOR($Resource.Breadwinner_QBO, 'Breadwinner_QBO/CSS/select2.min.css')}"/>
                    
                <script>
                    function HideStyleSheet(){
                        $("link.user[href$='elements.css']").each(function(){
                            //$(this).attr("href", "#");
                        });
                }
                function message()
                {
                    $(".infoM6, .infoM4, .infoM3, .infoM2, .infoS1").addClass("slds-notify slds-notify--alert slds-theme--inverse-text  slds-text-align--left slds-text-heading--small slds-m-bottom--small").css( {"font-weight":"500","line-height":"1.4","word-spacing":"1px"} );
                    $(".errorM6, .errorM4, .errorM3, .errorM2, .errorS1").addClass("slds-notify slds-notify--alert slds-theme--error  slds-text-align--left slds-text-heading--small slds-m-bottom--small").css( {"font-weight":"500","line-height":"1.4","word-spacing":"1px"} );
                    $(".warningM6, .warningM4, .warningM3, .warningM2, .warningS1").addClass("slds-notify slds-notify--alert slds-theme--warning  slds-text-align--left slds-text-heading--small slds-m-bottom--small").css( {"font-weight":"500","line-height":"1.4","word-spacing":"1px"} ) ;
                    $(".confirmM6, .confirmM4, .confirmM3, .confirmM2, .confirmS1").addClass("slds-notify slds-notify--alert slds-theme--success slds-text-align--left slds-text-heading--small slds-m-bottom--small").css( {"font-weight":"500","line-height":"1.4","word-spacing":"1px"} ) ;               
                    
                    $("div .messageText h4").css( {"color": "white","padding-right" : "2px"});
                    $("div[class*='warning'] div.messageText h4").css( "color", "black" );
                    $("table.messageTable td").css({"color" : "white"});
                    $("div[class*='warning'] table.messageTable td").css( "color", "black" );
                    $("select option:contains('Select Revenue Account')").attr("disabled","disabled").css( "color", "#aaa" );
                    $("select option:contains('Revenue Codes')").attr("disabled","disabled").css( {"color":"black","font-weight":"bold" });
                    $("select option:contains('Liabilities and Expenses')").attr("disabled","disabled").css( {"color":"black","font-weight":"bold" });
 
                    $("select option:contains('Select Tax Code')").css( "color", "#aaa" );                          
                }
                function DatepickerOnfocusToOnclick(){
                    
                    $("input[onfocus*='DatePicker.pickDate']").each(function( index ) {
                        var getfocusmethod=$( this ).attr("onfocus");
                        $( this ).attr("onclick",getfocusmethod).removeAttr("onfocus");
                    });
                    $(".datePicker").css({"display" : "none"});
                }
                    $(function(){
                        initSelect2();
                         HideStyleSheet();
                        message();
                        DatepickerOnfocusToOnclick();
                    });
                
                function showHideSectionConent(sectionId){
                    var sectiondiv=document.getElementById(sectionId);
                    
                    if($(sectiondiv).hasClass("slds-is-open")){
                        $(sectiondiv).removeClass("slds-is-open");
                    }
                    else{
                        $(sectiondiv).addClass("slds-is-open");
                    }
                }
                
                function initSelect2(){
                    console.log('init select 2');
                    $('.select2.init').removeClass('init').select2({
                        //placeholder: "Select a Product/Service",
                    });
                }
                
                var accountToTaxMap = {}; 
                function pushaccountToTaxMap (key, value){
                    accountToTaxMap[key] =value;
                    console.log(accountToTaxMap);
                }
                var missingLineItemMap = new Object();
                function pushTomissingLineItemMap(key,value){
                    console.log('###Key==>'+key+'==Value==>'+value);
                    missingLineItemMap[key] = value;
                    var jsonActions = JSON.stringify(missingLineItemMap);
                    document.getElementById('{!JSENCODE($Component.theForm.missingLineItemMap)}').value = jsonActions;
                }
                function showLoader(){
                    $('#message').show();
                }
                function enableDisable(enDiv,dsDiv,action)
                {
                    var isReadOnlyMode = {!isReadOnlyMode};
                    $('#'+dsDiv).children().attr("disabled","disabled");
                    $('#'+enDiv).children().removeAttr("disabled");
                     if(action == 'match' || isReadOnlyMode == true ){
                        $('#'+dsDiv+'P').children().attr("disabled","disabled").addClass('makeGray');
                        $('#'+dsDiv+'PL').children().attr("disabled","disabled").addClass('makeGray');
                        $('#'+dsDiv+'T').find('*').attr("disabled","disabled").addClass('makeGray');
                        
                        $('#'+dsDiv+'Tx').addClass('makeGray'); 
                    }else{
                        $('#'+enDiv+'P').children().removeAttr("disabled").removeClass('makeGray');
                        $('#'+enDiv+'PL').children().removeAttr("disabled").removeClass('makeGray');
                        $('#'+enDiv+'T').find('*').removeAttr("disabled").removeClass('makeGray');
                        $('#'+dsDiv+'Tx').removeClass('makeGray');
                        
                    }
                }
                function displayColonWarning(){
                    var i=0;
                    var hasColon = false;
                    while(!hasColon){
                        var pnameId = '#pg\\:theForm\\:mli\\:'+i+'\\:pname';
                        if($(pnameId).length == 0){
                            console.log('null found and break');
                            break;
                        }
                        if($(pnameId).hasClass('makeGray') == false){
                            var pname = $(pnameId).val();
                            if(pname.indexOf(':') > -1){
                                hasColon = true;
                            }
                        }
                        i++
                    }
                    if(hasColon){
                        $('#colonWarning').show();
                    }else{
                        $('#colonWarning').hide();
                    }
                }
                function disableCreateButtons(){
                    $('input[class*="disableMe-Onlick"]').attr({disabled:"disabled",value:"Creating...."});
                    $('#spinnerId').show();
                    
                }
                </script>
                <style>
                    body .bPageBlock, body #bodyCell .bResource .secondaryPalette, body .secondaryPalette.bPageBlock, body .individualPalette .secondaryPalette.bPageBlock, body .bodyDiv .genericTable, body .genericPageBlockTable, body .bodyDiv .bSubBlock, body .bComponentBlock .bPageBlock, body .bMyDashboard .bPageBlock, body.rlHoverFrame .bPageBlock, body.subjectSelectionPopup div.choicesBox, body.lookupTab .secondaryPalette.bPageBlock, body.popupTab .secondaryPalette.bPageBlock, body.UserTagStatsPage .secondaryPalette.bPageBlock {
                        background-color: white;
                        -moz-border-radius: 4px;
                        border: 0px;
                        -webkit-border-radius: 4px;
                        border-radius: 4px;
                    }
                    .text-right{
                        text-align:right;
                    }
                    
                    th.Headertocenter>div{
                        text-align: center;
                    }
                    .Headertocenter{
                        background-color: white !important;
                        font-weight: normal !important;
                        padding: 4px 2px 4px 5px !important;
                    }
                    .productColumnClass{
                        width:initial;
                        text-align:left !important;
                        
                    }
                    .deleteColumnClass, .productOutputColumnClass, .descriptionColumnClass, .accountColumnClass, .quantityColumnClass, .rateColumnClass, .amountColumnClass, .vatColumnClass, .taxRateColumnClass, .classColumnClass, .deleteColumnClass{
                        width:initial;
                    }
                   
                    @media (min-width: 48em){
                        .BreadwinnerLightning .slds-modal__container {
                            margin: 0 auto;
                            width: 55% ;
                            max-width: 70rem ;
                            min-width: 35rem ;
                        }
                    
                        .serviceDateColumnClass{
                            width:8%;
                        }
                        .productOutputColumnClass{
                             width:20%;
                        }
                    
                        .productColumnClass{
                            width:20%;
                        }
                        .descriptionColumnClass{
                            width:20%;
                        }
                        .accountColumnClass{
                            width:15%;
                        }
                        .quantityColumnClass{
                            width:5%;
                        }
                        .rateColumnClass{
                            width:7%;
                        }
                        .amountColumnClass{
                            width:8%;
                        }
                        .vatColumnClass{
                            width:10%;
                        }
                        .taxRateColumnClass{
                            width:5%;
                        }
                        .classColumnClass{
                            width:10%;
                        }
                        .deleteColumnClass{
                            width:5%;
                        }
                    
                    }
                    
                    table.slds-table td>img {
                        max-width: 24px !important;
                        height: 24px !important;
                        width: 24px !important;
                    }
                    .dateFormat{
                        display:none;
                    }
                    td img[src$="/s.gif"] {
                        display: none;
                    }
                    #InvoiceNumberid,#InvoiceNumberid a{
                        color:red;
                    }
                    #InvoiceNumberid a:hover{
                        color:blue;
                    }
                    .message {
                        background-color: inherit;
                        border-style: none;
                        padding:initial;
                        margin: 0px;
                    }
                    .msgIcon{
                        display:none;
                    }
                    .message .messageText {
                        margin: 0px;
                    }
                    .message .messageText h4 {
                        font-weight: inherit;
                        display: initial;
                    }
                    .BreadwinnerLightning hr {
                        margin: 1rem 0;
                    }
                
                    .BreadwinnerLightning .slds-page-header {
                        border-bottom: none;
                    }
                    .apexp .bPageBlock.apexDefaultPageBlock .pbBody {
                        margin: 0px;
                    }
                    .BreadwinnerLightning .slds-section__title-action:active, 
                    .BreadwinnerLightning .slds-section__title-action:focus, 
                    .BreadwinnerLightning .slds-section__title-action:hover{
                        background: initial;
                    }
                    .BreadwinnerLightning .slds-section-title--divider .slds-button:focus{
                        box-shadow: initial;
                    }
                    #EmailPopup{
                        display:none;
                        top:0px;
                        position:absolute;
                        width : 100%;
                        height: 100px;
                    }
                    .BreadwinnerLightning table {
                        border-collapse: inherit;
                    }
                    .select2-results__option {
                        margin-left:0;
                        line-height: 18px !important;
                    }
                    .select2-container .select2-selection--single .select2-selection__rendered{
                        padding-right:0px !important;
                        text-overflow: inherit;
                    }
                    .select2-container--default .select2-selection--single .select2-selection__rendered {
                        line-height: 23px !important;
                        margin: -11px;
                        margin-right: 1.1rem;
                    }
                    .select2-container .select2-selection--single{
                        height: 23px !important;
                        padding: 15px;
                    }
                    .slds-select .select2{
                        font-color:red !important;
                        padding-left: 0px !important;
                    }
                    
                    .select2-container--default .select2-selection--single {
                        border: 1px solid #d8dde6;
                    }
                    .select2-container--default .select2-selection--single .select2-selection__arrow b {
                        border-color: black transparent transparent 
                    }
                    .select2-container--default.select2-container--open .select2-selection--single .select2-selection__arrow b{
                        border-color: transparent transparent black transparent
                    }
                    .select2-dropdown{
                        border: 1px solid #d8dde6;
                    }
                    .select2-results__options {
                        list-style: inherit;
                    }
                    li.select2-results__option{
                        margin-left: 0px;
                    }
                    .select2-container--default .select2-search--dropdown .select2-search__field {
                        border: 1px solid #d8dde6;
                        border-radius: 4px;
                    }
                    .datePicker{
                        display:none;
                    }
                    .BreadwinnerLightning .slds-spinner_container{
                        z-index: 9999;
                        position: fixed;                    
                    }
                </style>
                <script>
                    
                    function showImage()
                    {        
                        $('#EmailPopup').css({'margin-top':'-10%','z-index':'1', 'border':'1px solid gray','position':'absolute'});
                        $('#EmailPopup').show();
                    }
                </script>
                <apex:outputPanel id="JSPanel">
                    <script type="text/javascript">
                    var itemMap = JSON.parse('{!SUBSTITUTE(JSENCODE(itemJSONString), "\\\"", "\"") }');
                    var taxCodeMap = JSON.parse('{!SUBSTITUTE(JSENCODE(taxCodeJSONString), "\\\"", "\"") }');
                    var taxRateMap = JSON.parse('{!SUBSTITUTE(JSENCODE(taxRateJSONString), "\\\"", "\"")}');
                    var isUSTaxModel = {!isUSTaxModel};
                    var allowDiscount = {!allowDiscount};
                    console.log(taxCodeMap);
                    console.log(taxRateMap);
                    initialize(itemMap, taxCodeMap, taxRateMap, isUSTaxModel, allowDiscount);
                    </script>
                </apex:outputPanel>
                </head>
                <body>
                    
                    <div class="BreadwinnerLightning">

                        <div id="spinnerId" class="slds-spinner_container" style="display:none;">
                            <div class="slds-spinner--brand slds-spinner slds-spinner--medium" aria-hidden="false" role="alert">
                                <div class="slds-spinner__dot-a"></div>
                                <div class="slds-spinner__dot-b"></div>
                            </div>
                        </div>

                        <apex:actionStatus id="assign-action-status" layout="block">
                            <apex:facet name="start">
                                <div class="slds-spinner_container">
                                    <div class="slds-spinner--brand slds-spinner slds-spinner--medium" aria-hidden="false" role="alert">
                                        <div class="slds-spinner__dot-a"></div>
                                        <div class="slds-spinner__dot-b"></div>
                                    </div>
                                </div>
                            </apex:facet>
                            <apex:facet name="stop"></apex:facet>
                        </apex:actionStatus>
                        <apex:outputPanel rendered="{!NOT(initialized)}">
                        <div class="slds-notify slds-notify--alert slds-theme--warning slds-m-top--small" >
                            <apex:pageMessage summary="This page is not initialized properly."  severity="WARNING" />
                        </div>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!initialized}">
                            <!---------------------------------------------------------------Header Start-------------------------------------------------------------------------------->
                            
                            <div class="slds-page-header" role="banner">
                                <div class="slds-grid">
                                    <div class="slds-col slds-has-flexi-truncate">
                                        <div class="slds-media slds-media--center slds-no-space slds-grow">
                                            <div class="slds-media__figure">
                                                <svg aria-hidden="true" class="slds-icon slds-icon-standard-user">
                                                    <use xlink:href="{!URLFOR($Resource.Breadwinner_QBO, 'Breadwinner_QBO/SLDS/assets/icons/utility-sprite/svg/symbols.svg#moneybag')}"></use>
                                                </svg>
                                            </div>
                                            <div class="slds-media__body">
                                                <p class="slds-text-heading--label">New QuickBooks Online {!IF(createSalesReceipt,'Sales Receipt', 'Invoice')} for</p>
                                                <h1 class="slds-page-header__title slds-m-right--small slds-truncate slds-align-middle">{!clientAccount.breadwinner_qbo__Company_Name__c}</h1>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <ul class="slds-grid  slds-page-header__detail-row">
                                    
                                    <li class="slds-page-header__detail-block">
                                        <p class="slds-text-heading--label-normal slds-truncate slds-m-bottom--xx-small">Company Information</p>
                                        <div class="slds-text-body--regular slds-truncate">
                                            <apex:outputPanel title="{!clientAccount.breadwinner_qbo__Company_Name__c}" rendered="{!AND(NOT(ISBLANK(clientAccount.breadwinner_qbo__Company_Name__c)),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Company_Name__c.accessible)}">
                                                {!clientAccount.breadwinner_qbo__Company_Name__c} <br/>
                                            </apex:outputPanel>
                                            <apex:outputPanel title="{!clientAccount.breadwinner_qbo__Street_Address__c}" rendered="{!AND(NOT(ISBLANK(clientAccount.breadwinner_qbo__Street_Address__c)),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Street_Address__c.accessible)}" >
                                                {!clientAccount.breadwinner_qbo__Street_Address__c}<br/>
                                            </apex:outputPanel>      
                                            <apex:outputPanel rendered="{!AND(OR(NOT(ISBLANK(clientAccount.breadwinner_qbo__Region__c)),NOT(ISBLANK(clientAccount.breadwinner_qbo__Postal_Code__c))),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__City__c.accessible,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Region__c.accessible,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Postal_Code__c.accessible)}" >
                                                {!clientAccount.City__c},&nbsp;{!clientAccount.Region__c}&nbsp;{!clientAccount.Postal_Code__c} <br/>
                                            </apex:outputPanel>
                                            <apex:outputPanel rendered="{!AND(NOT(ISBLANK(clientAccount.breadwinner_qbo__Country__c)),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Country__c.accessible)}" >
                                                {!clientAccount.breadwinner_qbo__Country__c}
                                            </apex:outputPanel>
                                        </div>
                                    </li>
                                    <li class="slds-page-header__detail-block">
                                        <p class="slds-text-heading--label-normal slds-truncate slds-m-bottom--xx-small">Contact Info</p>
                                        <div class="slds-text-body--regular slds-truncate">
                                            <apex:outputPanel title="{!clientAccount.breadwinner_qbo__Given_Name__c}" rendered="{!AND(NOT(ISBLANK(clientAccount.breadwinner_qbo__Given_Name__c)),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Given_Name__c.accessible)}" >
                                                {!clientAccount.breadwinner_qbo__Given_Name__c} <BR/>
                                            </apex:outputPanel>
                                            <apex:outputPanel title="{!clientAccount.breadwinner_qbo__Email__c}" rendered="{!AND(NOT(ISBLANK(clientAccount.breadwinner_qbo__Email__c)),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Email__c.accessible)}" >
                                                {!clientAccount.breadwinner_qbo__Email__c} <BR/>
                                            </apex:outputPanel>
                                            <apex:outputPanel title="{!clientAccount.breadwinner_qbo__Phone_Number__c}" rendered="{!AND(NOT(ISBLANK(clientAccount.breadwinner_qbo__Phone_Number__c)),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Phone_Number__c.accessible)}" >
                                                {!clientAccount.breadwinner_qbo__Phone_Number__c} <BR/>
                                            </apex:outputPanel>
                                        </div>
                                    </li>                                  
                                        <apex:outputPanel title="{!IF(ISBLANK(appConfigMap[clientAccount.breadwinner_qbo__QBO_Org_ID__c].Display_Name__c), clientAccount.breadwinner_qbo__QBO_Org_Name__c, appConfigMap[clientAccount.breadwinner_qbo__QBO_Org_ID__c].Display_Name__c)}" styleclass="slds-page-header__detail-block" rendered="{!AND(isMultiOrgEnabled,NOT(ISBLANK(clientAccount.breadwinner_qbo__QBO_Org_ID__c)),OR(NOT(ISBLANK(appConfigMap[clientAccount.breadwinner_qbo__QBO_Org_ID__c].Display_Name__c)),NOT(ISBLANK(clientAccount.breadwinner_qbo__QBO_Org_Name__c))),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__QBO_Org_Name__c.accessible)}">
                                            <p class="slds-text-heading--label-normal slds-truncate slds-m-bottom--xx-small">QuickBooks Online Org:</p>
                                            <div class="slds-text-body--regular slds-truncate">
                                               {!IF(ISBLANK(appConfigMap[clientAccount.breadwinner_qbo__QBO_Org_ID__c].Display_Name__c), clientAccount.breadwinner_qbo__QBO_Org_Name__c, appConfigMap[clientAccount.breadwinner_qbo__QBO_Org_ID__c].Display_Name__c)}
                                            </div>
                                            <apex:outputPanel rendered="{!NOT(ISBLANK(appConfigMap[clientAccount.breadwinner_qbo__QBO_Org_ID__c].Logo_URL__c))}">
                                                 <apex:image style="height: 40px" url="{!appConfigMap[clientAccount.breadwinner_qbo__QBO_Org_ID__c].Logo_URL__c}" />
                                            </apex:outputPanel>
                                        </apex:outputPanel> 
                                        <!---Multi Curency Availablef for Proffesional and Above i.e if plan code>=35-->                                                                    
                                        <apex:outputPanel styleclass="slds-page-header__detail-block" rendered="{!AND(isMultiCurrencyEnabled,Plan_Code>=35,NOT(ISBLANK(clientAccount.breadwinner_qbo__Currency__c)),$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Currency__c.accessible)}">
                                            <p class="slds-text-heading--label-normal slds-truncate slds-m-bottom--xx-small">Currency</p>
                                            <div class="slds-text-body--regular slds-truncate">
                                                {!clientAccount.breadwinner_qbo__Currency__c}
                                            </div>
                                        </apex:outputPanel>                                    
                                </ul>
                            </div>
                            <apex:pageMessage summary="You are using Breadwinner in QuickBooks Online Read Only Mode. While Breadwinner reads data from QuickBooks Online, no changes will be made to QuickBooks Online. QuickBooks Online is in Read-Only mode and will not be altered in any way." severity="Info" rendered="{!isReadOnlyMode}"/>
                            <!---------------------------------------------------------------Header End-------------------------------------------------------------------------------->
                            <!---------------------------------------------------------------Payments Info Start-------------------------------------------------------------------------------->
                            <apex:outputPanel rendered="{!Add_Payment}" layout="block">
                                <h3 class="slds-section-title--divider slds-m-top--small">Payment Details</h3>
                                <div class="slds-m-left--medium">
                                    <div class="slds-text-body--small slds-m-top--small"> A Payment will be created in QuickBooks Online and applied to this Invoice</div>
                                    
                                    
                                    <div class="slds-grid slds-wrap slds-m-top--small slds-m-bottom--medium">
                                        
                                        <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2">
                                            <div class="slds-form-element">
                                                <span class="slds-form-element__label">Payment Amount</span>
                                                <div class="slds-form-element__control ">
                                                    <span class="slds-form-element__static"><apex:outputText value="{!payment_Amount}"/></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2">
                                            <div class="slds-form-element">
                                                <span class="slds-form-element__label">Payment Deposit To</span>
                                                <div class="slds-form-element__control ">
                                                    <span class="slds-form-element__static"><apex:outputText value="{!payment_Deposit_To}"/></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2">
                                            <div class="slds-form-element">
                                                <span class="slds-form-element__label">Payment Method</span>
                                                <div class="slds-form-element__control">
                                                    <span class="slds-form-element__static"><apex:outputText value="{!payment_Type}"/></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2">
                                            <div class="slds-form-element">
                                                <span class="slds-form-element__label">Payment Reference</span>
                                                <div class="slds-form-element__control">
                                                    <span class="slds-form-element__static"><apex:outputText value="{!payment_Reference}" /></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </apex:outputPanel>
                            <!---------------------------------------------------------------Payments Info End-------------------------------------------------------------------------------->
                            
                            <!---------------------------------------------------------------Invoice Info Start-------------------------------------------------------------------------------->
                            <apex:pageBlock id="theInvoiceDetailBlock">
                                <div class=" slds-m-top--small"/>
                                <apex:pageMessages escape="false"/>
                                <apex:outputPanel id="isOAuth">
                                <apex:pageMessage rendered="{!isOAuthIssue}" escape="false" detail="{!oAuthExceptionWarningMessage}" summary="There was a problem with the connection to QuickBooks Online:" severity="WARNING" strength="0" />
                                <apex:pageMessage rendered="{!NOT(isAllowedToCreateOrUpdateINvoice)}" escape="false" detail="You do not have sufficient permissions in Salesforce to create an Invoice." summary="ERROR" severity="ERROR" strength="0" />                                
                                </apex:outputPanel>
                                    <h3 class="slds-section-title--divider" style="display:{!IF(OR($ObjectType.Invoice__c.fields.Terms_Ref__c.createable,$ObjectType.Invoice__c.fields.Invoice_Date__c.createable,$ObjectType.Invoice__c.fields.Due_Date__c.createable,$ObjectType.Invoice__c.fields.Name.createable,$ObjectType.Invoice__c.fields.Email__c.createable),'','none')}">{!IF(createSalesReceipt,'Sales Receipt', 'Invoice')} Details</h3>
                                    
                                    <!---------------------------------------------------------------Invoice fields Section Start here-------------------------------------------------------------------------------->
                                    <div class="slds-grid slds-wrap slds-m-bottom--small" style="display:{!IF(OR($ObjectType.Invoice__c.fields.Terms_Ref__c.createable,$ObjectType.Invoice__c.fields.Invoice_Date__c.createable,$ObjectType.Invoice__c.fields.Due_Date__c.createable,$ObjectType.Invoice__c.fields.Name.createable,$ObjectType.Invoice__c.fields.Email__c.createable),'','none')}">
                                        <div class=" slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-2">
                                             
                                            <apex:outputPanel layout="block" styleClass="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 slds-m-top--small" rendered="{!AND($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Terms_Ref__c.createable,NOT(createSalesReceipt))}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label" >Terms</label>
                                                    <div class="slds-form-element__control">
                                                       <apex:selectList value="{!sfInvoice.breadwinner_qbo__Terms_Ref__c}" size="1" styleClass="slds-input">
                                                            <apex:selectOption value="{!null}" />
                                                            <apex:selectOptions value="{!termsList}" />
                                                            <apex:actionSupport event="onchange" rendered="{!NOT(createSalesReceipt)}" action="{!handleInvoiceDueDate}" reRender="dueDate" focus="dueDate" oncomplete="DatepickerOnfocusToOnclick();"/>
                                                        </apex:selectList>
                                                    </div>
                                                </div>
                                            </apex:outputPanel>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 slds-m-top--small" style="display:{!IF($ObjectType.Invoice__c.fields.Invoice_Date__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label" >{!IF(createSalesReceipt,'Sales Receipt', 'Invoice')} Date</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField id="invoiceDate" label="{!IF(createSalesReceipt,'Sales Receipt', 'Invoice')} Date" value="{!sfInvoice.breadwinner_qbo__Invoice_Date__c}" rendered="{!$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Invoice_Date__c.createable}" styleClass="slds-input" html-autofocus="false">
                                                            <apex:actionSupport event="onchange" rendered="{!NOT(createSalesReceipt)}" action="{!handleInvoiceDueDate}" reRender="dueDate" focus="dueDate" oncomplete="DatepickerOnfocusToOnclick();"/>
                                                        </apex:inputField>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 slds-m-top--small">
                                                <apex:outputPanel rendered="{!AND($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Due_Date__c.createable,NOT(createSalesReceipt))}">
                                                    <div class="slds-form-element">
                                                        <label class="slds-form-element__label" >Due Date</label>
                                                        <div class="slds-form-element__control">
                                                            <apex:inputField id="dueDate" label="Due Date" value="{!sfInvoice.breadwinner_qbo__Due_Date__c}"
                                                                             rendered="{!AND($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Due_Date__c.createable,NOT(createSalesReceipt))}" styleClass="slds-input" />
                                                        </div>
                                                    </div>
                                                </apex:outputPanel>
                                            </div>
                                            
                                        </div>
                                        <div class="slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-2">
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 slds-m-top--small"  >
                                                <div class="slds-form-element">
                                                    <span class="slds-form-element__label">Invoice Number</span>
                                                    <div class="slds-form-element__control">
                                                        
                                                        <apex:outputText value="Auto Determined by QuickBooks Online" rendered="{!NOT(isCustomTxnNumberEnabled)}" />
                                                        <apex:inputText styleClass="slds-input" value="{!CustomTransactionNumber}" rendered="{!isCustomTxnNumberEnabled}"/>
                                                        <apex:outputPanel rendered="{!AND(isCustomTxnNumberEnabled,isOnTrial)}">
                                                            <div id="InvoiceNumberid" class="slds-text-heading--label-normal slds-m-top--small" >If you would like QuickBooks Online to populate the Invoice number for you, please&nbsp;<apex:outputLink value="{!breadwinnerSupportPortalURL}/customer/en/portal/articles/2329129-custom-transaction-numbers?b_id=9335" target="_blank" >disable custom transaction numbers in QuickBooks Online Company Settings</apex:outputLink>.
                                                            </div>
                                                        </apex:outputPanel>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 slds-m-top--small" style="display:{!IF($ObjectType.Invoice__c.fields.Email__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label" >Email</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField id="email" label="Email"  value="{!sfInvoice.breadwinner_qbo__Email__c}" styleClass="slds-input" html-maxlength="100"/>
                                                        <div style="color:silver;" class="slds-text-body--small slds-m-top--small" >You can send emails to multiple people, by adding more emails, separated by commas.<img class="InfoImage" onmouseover="showImage();" onmouseout="$('#EmailPopup').hide()" style="margin-left: 2px;margin-bottom: 2px;height:13px;width:13px;" src="{!URLFOR($Resource.Breadwinner_QBO, 'Breadwinner_QBO/Images/InfoLightning.png')}" /><span class="slds-assistive-text">Help</span> You must then choose "Create and Send Email {!IF(createSalesReceipt,'Sales Receipt', 'Invoice')} via QuickBooks Online" below.</div> 
                                                        <img src="{!URLFOR($Resource.Breadwinner_QBO, 'Breadwinner_QBO/Images/Email_Popup.png')}" id ="EmailPopup" />                                                       
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    
                                    </div>
                                    <!---------------------------------------------------------------Invoice fields Section ends here-------------------------------------------------------------------------------->
                                    <!---------------------------------------------------------------Address fields Section starts here-------------------------------------------------------------------------------->
                                    <div class="slds-section" id="DeleteRecDivId" style="display:{!IF(OR(AND(OR($ObjectType.Invoice__c.fields.Shipping_Street_Address__c.createable,$ObjectType.Invoice__c.fields.Shipping_City__c.createable,$ObjectType.Invoice__c.fields.Shipping_State__c.createable,$ObjectType.Invoice__c.fields.Shipping_Postal_Code__c.createable,$ObjectType.Invoice__c.fields.Shipping_Country__c.createable,$ObjectType.Invoice__c.fields.Shipping_Country__c.createable,$ObjectType.Invoice__c.fields.Shipping_Method__c.createable,$ObjectType.Invoice__c.fields.Shipping_Date__c.createable,$ObjectType.Invoice__c.fields.Tracking_Number__c.createable),isShippingAddressEnabled),$ObjectType.Invoice__c.fields.Billing_Street_Address__c.createable,$ObjectType.Invoice__c.fields.Billing_City__c.createable,$ObjectType.Invoice__c.fields.Billing_State__c.createable,$ObjectType.Invoice__c.fields.Billing_Postal_Code__c.createable,$ObjectType.Invoice__c.fields.Billing_Country__c.createable),'','none')}">
                                      <h3 class="slds-section-title--divider slds-m-top--medium" style="padding: .25rem;">
                                        <button class="slds-button slds-section__title-action" type="button" onclick="showHideSectionConent('DeleteRecDivId');" style="letter-spacing: .0625rem;text-transform: initial;">
                                          <svg aria-hidden="true" class="slds-section__title-action-icon slds-button__icon slds-button__icon--left">
                                            <use xlink:href="{!URLFOR($Resource.Breadwinner_QBO, 'Breadwinner_QBO/SLDS/assets/icons/utility-sprite/svg/symbols.svg#switch')}"></use>
                                          </svg><span style="color: #54698d;    text-transform: uppercase;">Billing Address and Shipping Information</span>
                                        </button>
                                      </h3>
                                      <div class="slds-section__content">
                                          <legend class="slds-m-left--small slds-text-heading--small slds-m-top--small"  style="display:{!IF(OR($ObjectType.Invoice__c.fields.Billing_Street_Address__c.createable,$ObjectType.Invoice__c.fields.Billing_City__c.createable,$ObjectType.Invoice__c.fields.Billing_State__c.createable,$ObjectType.Invoice__c.fields.Billing_Postal_Code__c.createable,$ObjectType.Invoice__c.fields.Billing_Country__c.createable),'','none')}">Billing Details:</legend>
                                        
                                          <div class="slds-grid slds-wrap slds-m-bottom--medium" style="display:{!IF(OR($ObjectType.Invoice__c.fields.Billing_Street_Address__c.createable,$ObjectType.Invoice__c.fields.Billing_City__c.createable,$ObjectType.Invoice__c.fields.Billing_State__c.createable,$ObjectType.Invoice__c.fields.Billing_Postal_Code__c.createable,$ObjectType.Invoice__c.fields.Billing_Country__c.createable),'','none')}">
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small" style="display:{!IF($ObjectType.Invoice__c.fields.Billing_Street_Address__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Street Address</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField id="Street_Address" label="Street_Address" value="{!sfInvoice.breadwinner_qbo__Billing_Street_Address__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small" style="display:{!IF($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Billing_City__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">City</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField id="City" label="City" value="{!sfInvoice.breadwinner_qbo__Billing_City__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small" style="display:{!IF($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Billing_State__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">State</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField id="State" label="State" value="{!sfInvoice.breadwinner_qbo__Billing_State__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small" style="display:{!IF($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Billing_Postal_Code__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Postal Code</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField id="Postal_code" label="City" value="{!sfInvoice.breadwinner_qbo__Billing_Postal_Code__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small" style="display:{!IF($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Billing_Country__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Country</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField id="Contry" label="Contry" value="{!sfInvoice.breadwinner_qbo__Billing_Country__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>
    
                                    </div>
    
                                          <apex:outputPanel rendered="{!AND(OR($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_Street_Address__c.createable,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_City__c.createable,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_State__c.createable,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_Postal_Code__c.createable,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_Country__c.createable,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_Country__c.createable,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_Method__c.createable,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_Date__c.createable,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Tracking_Number__c.createable),isShippingAddressEnabled)}" layout="block">
                                        <legend class="slds-text-heading--small slds-m-left--small">Shipping Details:</legend>
                                        <div class="slds-grid slds-wrap">
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small" style="display:{!IF($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_Street_Address__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Street Address</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField label="Street_Address" value="{!sfInvoice.breadwinner_qbo__Shipping_Street_Address__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small" style="display:{!IF($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_City__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">City</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField label="City" value="{!sfInvoice.breadwinner_qbo__Shipping_City__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small" style="display:{!IF($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_State__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">State</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField label="State" value="{!sfInvoice.breadwinner_qbo__Shipping_State__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small" style="display:{!IF($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_Postal_Code__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Postal Code</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField label="City" value="{!sfInvoice.breadwinner_qbo__Shipping_Postal_Code__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small" style="display:{!IF($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_Country__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Country</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField label="Contry" value="{!sfInvoice.breadwinner_qbo__Shipping_Country__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small" style="display:{!IF($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_Method__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Shipping Via</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField value="{!sfInvoice.breadwinner_qbo__Shipping_Method__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class=" slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small" style="display:{!IF($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Shipping_Date__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Shipping Date</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField value="{!sfInvoice.breadwinner_qbo__Shipping_Date__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small" style="display:{!IF($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Tracking_Number__c.createable,'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Tracking No</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField value="{!sfInvoice.breadwinner_qbo__Tracking_Number__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--2-of-5 slds-m-top--small">
                                            </div>
                                        </div>
                                    </apex:outputPanel>
                                        <hr/>
                                      </div>
                                    </div>
                                    <!---------------------------------------------------------------Address fields Section ends here-------------------------------------------------------------------------------->

                                    <!---------------------------------------------------------------custom fields Section Start here-------------------------------------------------------------------------------->
                                    <apex:outputPanel layout="block" styleClass="slds-m-bottom--small" rendered="{!AND(OR($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Custom_Field_1_Value__c.createable,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Custom_Field_2_Value__c.createable,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Custom_Field_3_Value__c.createable,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Location_Field_Value__c.createable,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Class__c.createable),OR(additionalFields.field_1_Enabled,additionalFields.field_2_Enabled,additionalFields.field_3_Enabled,companySettings.AccountingInfoPrefs.TrackDepartments,isClassTrackingPerTxnEnabled))}">
                                        
                                        <div class="slds-text-heading--small slds-m-left--small slds-m-top--xxx-small">Custom Fields:</div>
                                        <div class="slds-clearfix  ">

                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small slds-float--left" style="display:{!IF(AND(additionalFields.field_1_Enabled,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Custom_Field_1_Value__c.createable),'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">{!additionalFields.field_1_Label}</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField value="{!sfInvoice.breadwinner_qbo__Custom_Field_1_Value__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small slds-float--left" style="display:{!IF(AND(additionalFields.field_2_Enabled,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Custom_Field_2_Value__c.createable),'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">{!additionalFields.field_2_Label}</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField value="{!sfInvoice.breadwinner_qbo__Custom_Field_2_Value__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="slds-col--padded slds-float--left slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small" style="display:{!IF(AND(additionalFields.field_3_Enabled,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Custom_Field_3_Value__c.createable),'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">{!additionalFields.field_3_Label}</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField value="{!sfInvoice.breadwinner_qbo__Custom_Field_3_Value__c}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small slds-float--left" style="display:{!IF(AND(companySettings.AccountingInfoPrefs.TrackDepartments,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Location_Field_Value__c.createable),'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">{!additionalFields.fieldLocationLabel}</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:selectList styleClass="slds-input" value="{!sfInvoice.breadwinner_qbo__Location_Field_Value__c}" size="1">
                                                            <apex:selectOptions value="{!additionalFields.fieldLocationOptions}"></apex:selectOptions>
                                                        </apex:selectList>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small slds-float--left" style="display:{!IF(AND(isClassTrackingPerTxnEnabled,$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Class__c.createable),'','none')}">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Class</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:selectList styleClass="slds-input" id="clsId" value="{!invoiceClassSelected}" size="1">
                                                            <apex:selectOptions value="{!QBOClassList}"></apex:selectOptions>
                                                        </apex:selectList>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                    </apex:outputPanel>

                                    <!---------------------------------------------------------------custom fields Section ends here-------------------------------------------------------------------------------->

                                    
                                    <!-- -------------------------------------------------------------Payments Section Start here------------------------------------------------------------------------------ -->
                                    <apex:outputPanel rendered="{!createSalesReceipt}" >
                                        <hr/>
                                        <div class="slds-text-heading--small slds-m-left--small">Payment Details:</div>
                                        <div class="slds-grid slds-wrap slds-m-bottom--small">
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Payment Method</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:selectList styleClass="slds-input" label="Payment Method" id="pMethod" value="{!salesReceiptPaymentMethod}" size="1">
                                                            <apex:selectOption value="{!null}" />
                                                            <apex:selectOptions value="{!paymentMethodList}" />
                                                        </apex:selectList>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Reference No</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:inputField value="{!sfInvoice.breadwinner_qbo__Payment_Reference_Number__c}" rendered="{!$ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Payment_Reference_Number__c.createable}" styleClass="slds-input" />
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-5 slds-m-top--small">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label">Deposit to</label>
                                                    <div class="slds-form-element__control">
                                                        <apex:selectList styleClass="slds-input" label="Deposit to" id="pAccount" value="{!salesReceiptDepositToAccount}" size="1">
                                                            <apex:selectOptions value="{!paymentDepositToAccountSelectOptionList}" />
                                                        </apex:selectList>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--2-of-5 slds-m-top--small">

                                            </div>

                                        </div>
                                    </apex:outputPanel>
                                    <!-- -------------------------------------------------------------payments Section ends here------------------------------------------------------------------------------ -->

                                    <!-- -------------------------------------------------------------LineItem Section Start------------------------------------------------------------------------------ -->
                                    <div class="slds-col--padded slds-m-top--small" >
                                        
                                        <apex:outputPanel rendered="{!NOT(isUSTaxModel)}" style="float:right;">
                                                    <label class="slds-form-element__label" >Amounts are</label>
                                                    <apex:selectList styleClass="slds-input slds-m-bottom--medium" label="Amounts are" id="gtaxId" value="{!GlobalTaxCalculation}" size="1" disabled="{!QBOTaxCodeList.size<2}">
                                                        <apex:selectOption itemValue="TaxExcluded" itemLabel="Exclusive of Tax"  rendered="{!QBOTaxCodeList.size>1}"/>
                                                        <apex:selectOption itemValue="TaxInclusive" itemLabel="Inclusive of Tax" rendered="{!QBOTaxCodeList.size>1}" />
                                                        <apex:selectOption itemValue="NotApplicable" itemLabel="No VAT/Tax" />
                                                        <apex:actionSupport event="onchange" oncomplete="initSelect2();updateEverything();" reRender="theTable" status="assign-action-status"/>
                                                    </apex:selectList>
                                        </apex:outputPanel>
                                        
                                        <apex:pageBlockTable value="{!lineItems}"  var="item" id="theTable" width="100%" styleClass="slds-table slds-table--bordered slds-max-medium-table--stacked-horizontal" >
                                            <apex:column headerClass="Headertocenter slds-text-title--caps"  styleClass="serviceDateColumnClass" id="serviceDateColumn" headervalue="Service Date" html-data-label="Service Date" rendered="{!AND($ObjectType.breadwinner_qbo__Line_Item__c.fields.breadwinner_qbo__Service_Date__c.createable, isServiceDateEnabled)}">
                                                <apex:inputField id="serviceDate" value="{!item.l.breadwinner_qbo__Service_Date__c}" styleClass="slds-input" />
                                            </apex:column>                                        
                                            <apex:column id="codeColumn" styleClass="productColumnClass" headerClass="Headertocenter slds-text-title--caps" headervalue="Product/Service"  html-data-label="Product/Service" rendered="{!AND(true,OR(item.isExisting == null , item.isExisting == false))}">
                                                <apex:selectList styleClass="slds-input select2 init" style="width:100%;" id="itemCode" value="{!item.invoiceItemCode}" size="1" onChange="updateItemDetails(this.value,this.id)">
                                                    <apex:selectOption value="{!NULL}"></apex:selectOption>
                                                    <apex:selectOptions value="{!itemSelectOptionList1}"></apex:selectOptions>
                                                    <apex:selectOptions value="{!itemSelectOptionList2}"></apex:selectOptions>
                                                    <apex:selectOptions value="{!itemSelectOptionList3}"></apex:selectOptions>
                                                    <apex:selectOptions value="{!itemSelectOptionList4}"></apex:selectOptions>
                                                    <apex:selectOptions value="{!itemSelectOptionList5}"></apex:selectOptions>
                                                    <apex:selectOptions value="{!itemSelectOptionList6}"></apex:selectOptions>
                                                    <apex:selectOptions value="{!itemSelectOptionList7}"></apex:selectOptions>
                                                    <apex:selectOptions value="{!itemSelectOptionList8}"></apex:selectOptions>
                                                    <apex:selectOptions value="{!itemSelectOptionList9}"></apex:selectOptions>
                                                    <apex:selectOptions value="{!itemSelectOptionList10}"></apex:selectOptions>
                                                </apex:selectList>
                                            </apex:column>
                                            
                                            <apex:column id="existing" styleClass="productOutputColumnClass" headerClass="Headertocenter slds-text-title--caps" headervalue="Product/Service"   html-data-label="Product/Service"  rendered="{!AND(OR(UseOpportunityProducts == 'UseProducts', UseCustomLineItems == 'UseLineItems',isInvoiceLineItemfromOpptyfieldsEnabled), item.isExisting )}">
                                                <apex:outputText value="{!IF(NOT(ISBLANK(item.manualMatchProductName)), item.manualMatchProductName, item.itemName)}"/>
                                            </apex:column>
                                            <apex:column id="descriptionColumn" styleClass="descriptionColumnClass" headerClass="Headertocenter slds-text-title--caps" headervalue="Description"   html-data-label="Description" >
                                                <apex:inputTextArea id="description" rows="1" onfocus="this.rows=3;"  onblur="this.rows=1;" value="{!item.invoiceDescription}" styleClass="slds-input"/>
                                            </apex:column>      
                                            <apex:column id="accountColumn" styleClass="accountColumnClass" headerClass="Headertocenter slds-text-title--caps" headervalue="Account"   html-data-label="Account" >
                                                <apex:outputText style="width:100%;" id="accountName" value="{!item.incomeAccount}"  />
                                                <apex:inputHidden id="accountNameInput" value="{!item.incomeAccount}" />
                                            </apex:column>
                                            <apex:column headervalue="QTY" styleClass="quantityColumnClass"  headerClass="Headertocenter slds-text-title--caps" html-data-label="QTY" > 
                                                <apex:inputText id="qty" value="{!item.invoiceQuantity}" styleClass="slds-input text-right" style="padding-right: 5px; padding-left: 5px;" onchange="updateEverything();">
                                                    
                                                </apex:inputText>
                                            </apex:column>
                                            <apex:column headervalue="Rate" styleClass="rateColumnClass" headerClass="Headertocenter  slds-text-title--caps" html-data-label="Rate" >
                                                <apex:inputText id="unitprice" value="{!item.invoicePrice}" styleClass="slds-input text-right" style="padding-right: 5px; padding-left: 5px;" onchange="updateEverything();"/> <apex:outputPanel rendered="{!NOT(ISBLANK(item.Discount))}" style="color:red;">*</apex:outputPanel>


                                                </apex:column>
                                            <apex:column id="amountColumn" styleClass="amountColumnClass" style="text-align:right;" headerClass="Headertocenter slds-text-title--caps"  headervalue="Amount{!IF(AND(isMultiCurrencyEnabled,Plan_Code>=35,NOT(ISBLANK(clientAccount.breadwinner_qbo__Currency__c)),defaultCurrencyCode!=clientAccount.breadwinner_qbo__Currency__c,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Currency__c.accessible),' ('+clientAccount.breadwinner_qbo__Currency__c+')','')}" html-data-label="Amount ({!IF(AND(isMultiCurrencyEnabled,Plan_Code>=35,NOT(ISBLANK(clientAccount.breadwinner_qbo__Currency__c)),defaultCurrencyCode!=clientAccount.breadwinner_qbo__Currency__c,$ObjectType.breadwinner_qbo__Breadwinner_Account_Connection__c.fields.breadwinner_qbo__Currency__c.accessible),clientAccount.breadwinner_qbo__Currency__c,'')})" >
                                                <apex:outputText id="amount" value="{!item.invoiceAmount}" />                                                
                                            </apex:column>
                                            <apex:column id="taxRateColumn" styleClass="taxRateColumnClass" headerClass="Headertocenter slds-text-title--caps" headervalue="Tax" html-data-label="Tax" style="text-align:center" rendered="{!isUSTaxModel}">
                                                <label class="slds-checkbox">
                                                    <apex:inputCheckbox id="taxable" value="{!item.isTaxable}" onchange="updateEverything();"/>
                                                    <span class="slds-checkbox--faux"></span>
                                                </label>                            
                                            </apex:column>
                                            <apex:column id="vatColumn" headerValue="Tax" styleClass="vatColumnClass" headerClass="Headertocenter slds-text-title--caps" html-data-label="Tax"  style="text-align:center;" rendered="{!NOT(isUSTaxModel)}">
                                                <apex:selectList styleClass="slds-input" style="width:100%; padding-right: 2px; padding-left: 2px;" id="vatId" value="{!item.taxCodeSelected}" onchange="updateEverything();" size="1" >
                                                    <apex:selectOptions value="{!QBOTaxCodeList}"></apex:selectOptions>
                                                </apex:selectList>
                                            </apex:column>
                                            <apex:column id="classColumn" styleClass="classColumnClass slds-text-title--caps" headerValue="Class" headerClass="Headertocenter slds-text-title--caps" html-data-label="Class" rendered="{!isClassTrackingPerTxnLineEnabled}">
                                                <apex:selectList style="width:100%;padding-right: 2px; padding-left: 2px;" styleClass="slds-input"  id="clsId" value="{!item.classSelected}" size="1" >
                                                    <apex:selectOptions value="{!QBOClassList}"></apex:selectOptions>
                                                </apex:selectList>
                                            </apex:column>
                                            <apex:column headervalue="" styleClass="deleteColumnClass" style="text-align:center;" headerClass="Headertocenter slds-text-title--caps" html-data-label="">
                                                <apex:image url="{!URLFOR($Resource.breadwinner_qbo__Breadwinner_QBO, 'Breadwinner_QBO/Images/BW_Delete.png')}"  onclick="removeItem({!item.srNo});" style="cursor: pointer;" >
                                                </apex:image>
                                                
                                            </apex:column>
                                        </apex:pageBlockTable>
                                        
                                        <apex:actionFunction name="removeItem" action="{!removeLineItemFromList}" status="assign-action-status" rerender="invoiceTax,TaxTotal,TaxAmount,theTable,subtotalColumn,discountTotal" oncomplete="updateEverything();initSelect2();">
                                            <apex:param name="srNo" value="" assignTo="{!srNo}"/>
                                        </apex:actionFunction>
                                        
                                        
                                        
                                        <!-- ---------------------------------------LineItem Section End  ----------------- ------------------------- -->
                                        
                                        <!-- ------------------------------- Messages and amounts section starts here ------------------------------- -->
                                        <div class="slds-grid slds-wrap">
                                            <div class="slds-size--1-of-1 slds-medium-size--3-of-6 slds-large-size--6-of-12">
                                                <div class="slds-col--padded slds-m-top--small slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1" style="display:{!IF(isAllowedToCreateOrUpdateINvoice,'','none')}">
                                                    <apex:commandLink value="Add more lines" status="assign-action-status"  action="{!addMoreLineItems}" oncomplete="initSelect2();" reRender="theTable,JSPanel" />
                                                </div>
                                                <div class="slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF($ObjectType.Invoice__c.fields.Message_Displayed__c.createable,'','none')}">
                                                    <div class="slds-form-element">
                                                        <label class="slds-form-element__label" >Message displayed on {!IF(createSalesReceipt,'Sales Receipt', 'Invoice')}</label>
                                                        <div class="slds-form-element__control">
                                                            <apex:inputTextArea rows="4" style="width:250px;margin-top:5px" styleclass="slds-textarea" value="{!sfInvoice.breadwinner_qbo__Message_Displayed__c}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small" style="display:{!IF($ObjectType.Invoice__c.fields.Statement_Memo__c.createable,'','none')}">
                                                    <div class="slds-form-element">
                                                        <label class="slds-form-element__label" >Statement memo</label>
                                                        <div class="slds-form-element__control">
                                                            <apex:inputTextArea rows="4" style="width:250px;margin-top:5px" styleclass="slds-textarea" value="{!sfInvoice.breadwinner_qbo__Statement_Memo__c}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="slds-size--1-of-1 slds-medium-size--3-of-6 slds-large-size--6-of-12 ">
                                                <div align="right" >
                                                    <div align="right" class="slds-m-top--medium">
                                                        
                                                        <div class="subTotalDiv " align="right"><apex:outputPanel id="subtotalColumn"  styleClass="text-right subtotal"><label class="slds-form-element__label" >Sub Total:</label><apex:outputPanel id="subtotalColumnIn">{!invoiceSubtotal}</apex:outputPanel></apex:outputPanel></div>
                                                        <apex:outputPanel rendered="{!isOppProductDiscountAvalible}">
                                                            <div align="right" class="slds-m-top--medium slds-m-bottom--medium"><span style="color:red;">*</span> The Line Item Rate is calculated from the Sales Price and the Discount Percentage</div>
                                                        </apex:outputPanel>
                                                        <apex:outputPanel rendered="{!isUSTaxModel}">
                                                            <label class="slds-form-element__label" >Taxable subtotal</label>
                                                            <apex:outputPanel id="TaxTotal">{!invoiceTaxableAmount}</apex:outputPanel><BR/>
                                                            <apex:selectList style="width:140px" styleClass="slds-input" id="taxRate" value="{!TaxType}" size="1" onchange="applyTaxAndDiscount();" rendered="{!QBOTaxCodeList.size > 1}">
                                                                <apex:selectOptions value="{!QBOTaxCodeList}"></apex:selectOptions>    
                                                            </apex:selectList> &nbsp;&nbsp;
                                                            <apex:outputPanel id="invoiceTax" >
                                                                <apex:outputPanel id="invoiceTaxAmt" style="display:{!IF(invoiceTax >0,'','none')}">{!invoiceTax}</apex:outputPanel>
                                                                <apex:outputPanel id="invoiceTaxPer" style="display:{!IF(invoiceTax >0,'','none')}">&nbsp;%</apex:outputPanel>&nbsp;&nbsp;
                                                            </apex:outputPanel>
                                                            <apex:outputPanel id="TaxAmount" style="display:{!IF(QBOTaxCodeList.size >1,'','none')};float:right;padding-top: 6px;">{!invoiceTaxAmount}</apex:outputPanel>
                                                            
                                                        </apex:outputPanel>
                                                        <apex:outputPanel rendered="{!allowDiscount}">
                                                            <div class="slds-m-top--medium">
                                                                
                                                                <apex:selectList id="discountType" value="{!discountType}" size="1" style="width:162px" styleClass="slds-input" onchange="applyTaxAndDiscount();">
                                                                    <apex:selectOptions value="{!discountTypeList}"></apex:selectOptions>
                                                                </apex:selectList>&nbsp;&nbsp;
                                                                
                                                                <apex:inputText id="index" value="{!invoiceDiscount}" styleClass="slds-input text-right" style="width:7em;" onchange="applyTaxAndDiscount();">
                                                                </apex:inputText>&nbsp;&nbsp;
                                                                
                                                                <apex:outputPanel id="discountTotal"  style="float:right;padding-top: 8px;">{!invoiceDiscountAmount}</apex:outputPanel>
                                                            </div>
                                                        </apex:outputPanel>
                                                        
                                                        <apex:outputPanel rendered="{!NOT(isUSTaxModel)}"><BR/>
                                                            <label class="slds-form-element__label" >
                                                                <apex:outputPanel id="vatText" >{!IF(GlobalTaxCalculation != 'NotApplicable', IF(GlobalTaxCalculation = 'TaxInclusive', 'Included ', '') + 'VAT/Tax', '')} :</apex:outputPanel> 
                                                            </label>
                                                            <apex:outputPanel id="vatAmount" style="float:right;">{!totalVAT}</apex:outputPanel>
                                                            
                                                        </apex:outputPanel><BR/>
                                                        <label class="slds-form-element__label slds-text-heading--label" >Total</label>
                                                        <apex:outputPanel id="invoiceTotal"  style="float:right;">{!invoiceTotal}</apex:outputPanel>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                        </div>
                                        <!-- ------------------------------- Messages and amounts section ends here ------------------------------- -->

                                        <!-- ------------------------------- Online Payments Sections starts here ------------------------------- -->
                                        <apex:outputPanel rendered="{!NOT(createSalesReceipt)}">
                                            <hr/>
                                            <div class="slds-grid slds-wrap" style="display:{!IF(OR(ETransactionPaymentEnabled, (ETransactionEnabledStatus=='Enabled')), '','none')};">
                                                <div class="slds-size--1-of-1 slds-medium-size--2-of-6 slds-large-size--4-of-12" >
                                                    <div>
                                                        <div class="slds-text-heading--small">Payment Details:</div>
                                                        <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1 slds-m-top--small">
                                                            <div class="slds-form-element">
                                                                <label class="slds-checkbox--toggle slds-grid">
                                                                    <span class="slds-form-element__label slds-m-bottom--none">Allow Online Payment</span>
                                                                    <apex:inputCheckbox value="{!AllowOnlinePayment}" onclick="onofffunctionapex();"/>
                                                                    <span id="toggle-desc" class="slds-checkbox--faux_container" aria-live="assertive">
                                                                        <span class="slds-checkbox--faux"></span>
                                                                        <span class="slds-checkbox--on">Enabled</span>
                                                                        <span class="slds-checkbox--off">Disabled</span>
                                                                    </span>
                                                                </label>
                                                            </div>
                                                            <apex:actionFunction name="onofffunctionapex" action="{!enableOnlinePayment}" rerender="view">     
                                                            </apex:actionFunction>
                                                        </div>
                                                        <div class="slds-col--padded slds-m-top--medium slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-1" style='display:{!IF((ETransactionEnabledStatus=="Enabled"),"block","none")};'>
                                                            <legend class="slds-form-element__label ">Let your customer pay you by:</legend>
                                                            <div class="slds-col--padded slds-form-element">
                                                                <label class="slds-form-element__label" ></label>
                                                                <div class="slds-form-element__control">
                                                                    <label class="slds-checkbox ">
                                                                        <apex:inputCheckbox value="{!AllowOnlineCreditCardPayment}"  />
                                                                        <span class="slds-checkbox--faux"></span>
                                                                        <span class="slds-form-element__label">Credit card </span> <apex:image url="{!URLFOR($Resource.breadwinner_qbo__Breadwinner_QBO, 'Breadwinner_QBO/Images/Credit_Cards.png')}"  height="20%" width="60%"/>
                                                                    </label>
                                                                    
                                                                    <label class="slds-checkbox slds-m-top--medium">
                                                                        <apex:inputCheckbox value="{!AllowOnlineACHPayment}"   />
                                                                        <span class="slds-checkbox--faux"></span>
                                                                        <span class="slds-form-element__label">Bank transfer</span> <apex:image url="{!URLFOR($Resource.breadwinner_qbo__Breadwinner_QBO, 'Breadwinner_QBO/Images/Bank.png')}"  height="20%" width="10%"/>
                                                                    </label>
                                                                    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </apex:outputPanel>
                                        
                                        <apex:outputPanel layout="block" styleclass="slds-m-top--medium" rendered="{!AND(sfInvoice.breadwinner_qbo__Opportunity__c!=null,isAllowedToUseChargentTransaction)}">
                                            <h1 class="slds-section-title--divider slds-m-top--medium">Payment Info</h1>
                                            
                                            <div class="slds-grid slds-wrap slds-m-top--medium slds-m-bottom--small">
                                                <div class="slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-2">
                                                    <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 ">
                                                        <div class="slds-form-element">
                                                            <span class="slds-form-element__label">Gateway Transaction ID</span>
                                                            <div class="slds-form-element__control">
                                                                <span class="slds-form-element__static">{!GatewayTrasactionId}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 ">
                                                        <div class="slds-form-element">
                                                            <span class="slds-form-element__label">Chargent Transaction Id</span>
                                                            <div class="slds-form-element__control">
                                                                <span class="slds-form-element__static">{!ChargentTrasactionId}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 ">
                                                        <div class="slds-form-element">
                                                            <span class="slds-form-element__label">Amount</span>
                                                            <div class="slds-form-element__control">
                                                                <span class="slds-form-element__static">{!ChargentPaymentAmount}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-2">
                                                    <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 ">
                                                        <div class="slds-form-element">
                                                            <span class="slds-form-element__label">Opportunity</span>
                                                            <div class="slds-form-element__control">
                                                                <span class="slds-form-element__static">{!ChargentOpportunityName}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 ">
                                                        <div class="slds-form-element">
                                                            <span class="slds-form-element__label">Payment Method</span>
                                                            <div class="slds-form-element__control">
                                                                <span class="slds-form-element__static">{!ChargentPaymentMethod}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-1 slds-large-size--1-of-2 ">
                                                        <div class="slds-form-element">
                                                            <span class="slds-form-element__label">Transaction Date/Time</span>
                                                            <div class="slds-form-element__control">
                                                                <span class="slds-form-element__static">{!ChargentTransactionCreatedDateTime}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <hr/>
                                        </apex:outputPanel>
                                        <!-- ------------------------------- Online Payments Sections ends here ------------------------------- -->
                                        
                                        <div class="slds-m-top--small slds-m-bottom--small">
                                            Once you click create, Breadwinner will post this to QuickBooks Online and provide you the URL if you wish to edit
                                            it further.
                                        </div>
                                        <div align="right">
                                            <apex:commandButton value="Create {!IF(createSalesReceipt,'Sales Receipt', 'Invoice')} in QuickBooks Online" onclick="createDraftInvoice(); disableCreateButtons(); return false;"  rendered="{!AND($ObjectType.breadwinner_qbo__Invoice__c.createable, showCreateDraftInvoiceButton)}" styleClass="disableMe-Onlick slds-button slds-button--brand slds-m-top--medium" disabled="{!OR(NOT(isAllowedToCreateOrUpdateINvoice),IsInvoiceCreationFailed,isOAuthIssue,isReadOnlyMode)}"/>
                                            <apex:commandButton value="Create and Send Email {!IF(createSalesReceipt,'Sales Receipt', 'Invoice')} via QuickBooks Online" onclick="createAndSendInvoice(); disableCreateButtons(); return false;"   rendered="{!($ObjectType.breadwinner_qbo__Invoice__c.createable)}" styleClass="disableMe-Onlick slds-button slds-button--brand slds-m-top--medium" disabled="{!OR(NOT(isAllowedToCreateOrUpdateINvoice),IsInvoiceCreationFailed,isOAuthIssue,isReadOnlyMode,NOT($ObjectType.breadwinner_qbo__Invoice__c.fields.breadwinner_qbo__Email__c.Createable))}"/>   
                                            
                                            <apex:outputPanel layout="block" styleclass="slds-text-heading--small slds-m-top--small" style="font-weight: bold;font-style: italic;" rendered="{!isReadOnlyMode}">You are using Breadwinner in QuickBooks Online Read Only Mode. While Breadwinner reads data from QuickBooks Online, no changes will be made to QuickBooks Online. QuickBooks Online is in Read-Only mode and will not be altered in any way.</apex:outputPanel>
                                        </div>
                                        
                                        
                                        <apex:actionFunction name="createDraftInvoice" action="{!createQBOInvoice}"/>
                                        <apex:actionFunction name="createAndSendInvoice" action="{!createAndSendInvoice}"/>
                                    </div>
                                </apex:pageBlock>
                                <!---------------------------------------------------------------Invoice Info End-------------------------------------------------------------------------------->
                            </apex:outputPanel>
                            <!-- ------------------------script for popups starts here ---------------------------------------------- -->
                            <apex:outputPanel id="scriptPanel" >
                                <script>
                                $(document).ready(function(){
                                    
                                    if(({!missingLineItemList.size} > 0)&&({!($ObjectType.breadwinner_qbo__Line_Item__c.fields.breadwinner_qbo__Product_Service__c.createable || $ObjectType.breadwinner_qbo__Line_Item__c.fields.breadwinner_qbo__Tax__c.createable||$ObjectType.breadwinner_qbo__Line_Item__c.fields.breadwinner_qbo__Tax_Code__c.createable)})){
                                        if(!{!isOAuthIssue})
                                        $('#mask').show();
                                        displayColonWarning();
                                        message();
                                        
                                    }
                                    //if close button is clicked
                                    $('.close').click(function () {
                                        
                                        $('#mask').hide();
                                        
                                    });
                                    updateEverything();
                                    message();
                                });
                               
                                </script>   
                            </apex:outputPanel>
                            <!-- ------------------------script for popups ends here ---------------------------------------------- -->

                            <!-- ------------------------------------- Popcode starts here ----------------------------------------- -->
                           
                            <apex:outputPanel id="PSPopop">
                                <div id="mask" style="display:none;">
                                    <div aria-hidden="false" aria-labelledby="prompt-heading-id" aria-describedby="prompt-message-wrapper" role="alertdialog" class="slds-modal slds-modal--prompt slds-fade-in-open">
                                        <div class="slds-modal__container slds-modal--prompt" role="document" id="prompt-message-wrapper" tabindex="0">
                                            <div class="slds-modal__header slds-theme--info">
                                                <h2 class="slds-text-heading--medium" id="prompt-heading-id">Create or Match to QuickBooks Product/Service</h2>
                                            </div>
                                            <div class="slds-modal__content slds-p-around--medium">
                                                <div>
                                                    <apex:actionStatus id="popup-status" layout="block">
                                                        <apex:facet name="start">
                                                            <div class="slds-spinner_container">
                                                                <div class="slds-spinner--brand slds-spinner slds-spinner--medium" aria-hidden="false" role="alert">
                                                                    <div class="slds-spinner__dot-a"></div>
                                                                    <div class="slds-spinner__dot-b"></div>
                                                                </div>
                                                            </div>
                                                        </apex:facet>
                                                    </apex:actionStatus>
                                                    <div class="slds-m-top--small slds-m-bottom--small" style="display:{!IF(isErrorOnItemCreation,'','none')}">
                                                        <b style="color:red">Error: </b>
                                                        <div style="color:red" class="slds-m-left--large">
                                                            {!errorMsg.fault.Error[0].Detail}
                                                         </div>
                                                    </div>
                                                    <p>
                                                     You are trying to create {!IF(createSalesReceipt,'a Sales Receipt', 'an Invoice')} in QuickBooks Online using Products/Services which are not in QuickBooks Online. This will require additional information, because QuickBooks Online requires New Product/Service to have a Revenue Account specified. So, to proceed, Breadwinner need to create this Product/Service with the Revenue Account you specify. (Please check with your CFO, Accountant, etc. if you are not sure what Revenue Account to use)<br/><br/>

                                                    Alternatively, instead of creating a new Product/Service in QuickBooks Online, you can pass this Line Item into QuickBooks Online using an existing Product/Service that is already in QuickBooks Online.<br/><br/>
                                                    To rephrase what is happening in this process, you must either pass QuickBooks Online an existing Product/Service by manually selecting one, or Breadwinner can create a new QuickBooks Online Product/Service but you will have to specify which Revenue Account to be associated with that Product/Service.
                                                    </p>
                                                    <div class="slds-m-top--medium">
                                                  <!------------------
                                                        <apex:variable var="row" value="{!1}"/>
                                                        <apex:repeat id="mli" value="{!missingLineItemList}" var="mli">
                                                         
                                                            <div class="slds-p-horizontal--small slds-p-top--small slds-p-bottom--small" style="background-color:{!IF(MOD(row,2)==1,'aliceblue','white')}">
                                                                <div class="slds-m-bottom--small">
                                                                    <div class="slds-text-heading--medium ">({!row}).{!IF(mli.productCode !=null,mli.productCode+' ','')}{!mli.productName}</div>
                                                                </div>
                                                                
                                                                <div class="slds-m-left--medium">
                                                                    <div class="slds-m-bottom--x-small">
                                                                        
                                                                        <label class="slds-radio" >
                                                                            <input type="radio"   name="{!mli.srNo}" id="{!mli.srNo}sm" value="{!mli.productName}" onChange="enableDisable('{!mli.srNo}prdDiv','{!mli.srNo}nprdTable','match');pushTomissingLineItemMap('{!mli.productName}', 'matchWithExisting');displayColonWarning();"/>
                                                                            <span class="slds-radio--faux"></span>
                                                                            <span class="slds-form-element__label"></span>
                                                                        </label>
                                                                        
                                                                        <label  class="slds-text-heading--small" for="{!mli.srNo}sm">Manually Match to Existing Product/Service</label><br/>
                                                                    </div>
                                                                    
                                                                    <div id="{!mli.srNo}prdDiv" class="slds-col--padded" style="display:{!IF($ObjectType.Line_Item__c.fields.Product_Service__c.createable,'','none')}">
                                                                        
                                                                        <apex:selectList styleClass="slds-input" style="width:50%" id="itemCode" value="{!mli.selectedProduct}" size="1" >
                                                                            <apex:selectOption value="{!null}"></apex:selectOption>
                                                                            <apex:selectOptions value="{!itemSelectOptionList1}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList2}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList3}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList4}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList5}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList6}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList7}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList8}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList9}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList10}"></apex:selectOptions>
                                                                        </apex:selectList>
                                                                    </div>
                                                                    <div class="slds-m-top--small slds-m-bottom--x-small" style="display:{!IF($ObjectType.Line_Item__c.fields.Product_Service__c.createable,'','none')}">
                                                                        
                                                                        <label class="slds-radio" for="{!mli.srNo}cn">
                                                                            <input type="radio"   name="{!mli.srNo}" id="{!mli.srNo}cn" value="CreateNew" onChange="enableDisable('{!mli.srNo}nprdTable','{!mli.srNo}prdDiv','create');pushTomissingLineItemMap('{!mli.productName}', 'createNew');displayColonWarning();"/>
                                                                            <span class="slds-radio--faux"></span>
                                                                            <span class="slds-form-element__label"></span>
                                                                        </label>
                                                                        <label  class="slds-text-heading--small" for="{!mli.srNo}cn">{!IF(mli.isInPurchaseMap,"Update Purchase Item in QuickBooks","Create a new Product/Service in QuickBooks")}</label><div style='display:{!IF(mli.isInPurchaseMap,"block","none")};margin-top: 5px;margin-left: 2.5%;   border-radius: 5px;' class='infoM4'>This Product/Service already exists in QuickBooks Online but it is missing required information. You must specify the Revenue Code and whether this is taxable before it can be used as a line item on an Invoice. </div>
                                                                    </div>
                                                                    <div class="slds-grid slds-wrap" id="{!mli.srNo}nprdTable">
                                                                        <div id="{!mli.srNo}nprdTableP" class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-3 slds-large-size--1-of-3">
                                                                            <apex:inputText id="pname" value="{!mli.productName}"  styleClass="slds-input" onchange="displayColonWarning();"/>
                                                                        </div>
                                                                        
                                                                        <div id="{!mli.srNo}nprdTablePL" class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-3 slds-large-size--1-of-3">
                                                                            <apex:selectList styleClass="slds-input" id="accountCode" label="Tax/VAT" value="{!mli.selectedAccountId}" size="1">
                                                                                <apex:selectOptions value="{!QBOAccountList}"></apex:selectOptions>
                                                                            </apex:selectList>
                                                                        </div>
                                                                        
                                                                        <div id="{!mli.srNo}nprdTableT" class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-3 slds-large-size--1-of-3" style="display:{!IF($ObjectType.Line_Item__c.fields.Tax__c.createable,'','none')}">
                                                                            <apex:outputPanel rendered="{!isUSTaxModel}">
                                                                                <div >
                                                                                    <label class="slds-checkbox">
                                                                                        <apex:inputCheckbox value="{!mli.isTaxable}"/>
                                                                                        <span class="slds-checkbox--faux"></span>
                                                                                        <span id="{!mli.srNo}nprdTableTx" class="slds-form-element__label">Taxable</span>
                                                                                    </label>
                                                                                    
                                                                                </div>
                                                                            </apex:outputPanel>
                                                                            <apex:outputPanel rendered="{!AND($ObjectType.Line_Item__c.fields.Tax_Code__c.createable,NOT(isUSTaxModel))}">
                                                                                <apex:selectList styleClass="slds-input" id="mlitaxCode" value="{!mli.taxCodeSelected}" size="1">
                                                                                    <apex:selectOptions value="{!QBOTaxCodeList}"></apex:selectOptions>
                                                                                </apex:selectList>
                                                                            </apex:outputPanel>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                </div>
                                                            </div>
                                                            <script>
                                                            document.getElementById('{!mli.srNo}cn').checked = true;
                                                            pushTomissingLineItemMap('{!JSENCODE(mli.productName)}', 'createNew');
                                                            var divId = '#{!mli.srNo}prdDiv'
                                                            $(divId).children().attr("disabled","disabled");;
                                                            </script>
                                                            <apex:variable var="row" value="{!row+1}"/>
                                                        </apex:repeat>
                                                        
                                                      ------------------->
                                                       <apex:variable var="row" value="{!1}"/>
                                                       <apex:repeat id="mli" value="{!missingLineItemMap}" var="mlim">
                                                            <apex:variable value="{!missingLineItemMap[mlim]}" var="mli" />
                                                            <div class="slds-p-horizontal--small slds-p-top--small slds-p-bottom--small" style="background-color:{!IF(MOD(row,2)==1,'aliceblue','white')}">
                                                                <div class="slds-m-bottom--small">
                                                                    <div class="slds-text-heading--medium ">({!row}).{!IF(mli.productCode !=null,mli.productCode+' ','')}{!mli.productName}</div>
                                                                </div>
                                                                
                                                                <div class="slds-m-left--medium">
                                                                    <div class="slds-m-bottom--x-small">
                                                                        
                                                                        <label class="slds-radio" >
                                                                            <input type="radio"   name="{!mli.srNo}" id="{!mli.srNo}sm" value="{!mli.productName}" onChange="enableDisable('{!mli.srNo}prdDiv','{!mli.srNo}nprdTable','match');pushTomissingLineItemMap('{!JSENCODE(mli.productName)}', 'matchWithExisting');displayColonWarning();"/>
                                                                            <span class="slds-radio--faux"></span>
                                                                            <span class="slds-form-element__label"></span>
                                                                        </label>
                                                                        
                                                                        <label  class="slds-text-heading--small" for="{!mli.srNo}sm">Manually Match to Existing Product/Service</label><br/>
                                                                    </div>
                                                                    
                                                                    <div id="{!mli.srNo}prdDiv" class="slds-col--padded" style="display:{!IF($ObjectType.Line_Item__c.fields.Product_Service__c.createable,'','none')}">
                                                                        
                                                                        <apex:selectList styleClass="slds-input" style="width:50%" id="itemCode" value="{!missingLineItemMap[mlim].selectedProduct}" size="1">
                                                                            <apex:selectOption value="{!null}"></apex:selectOption>
                                                                            <apex:selectOptions value="{!itemSelectOptionList1}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList2}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList3}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList4}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList5}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList6}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList7}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList8}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList9}"></apex:selectOptions>
                                                                            <apex:selectOptions value="{!itemSelectOptionList10}"></apex:selectOptions>
                                                                        </apex:selectList>
                                                                    </div>
                                                                    <div class="slds-m-top--small slds-m-bottom--x-small" style="display:{!IF($ObjectType.Line_Item__c.fields.Product_Service__c.createable,'','none')}">
                                                                        
                                                                        <label class="slds-radio" for="{!mli.srNo}cn">
                                                                            <input type="radio"   name="{!mli.srNo}" id="{!mli.srNo}cn" value="CreateNew" onChange="enableDisable('{!mli.srNo}nprdTable','{!mli.srNo}prdDiv','create');pushTomissingLineItemMap('{!JSENCODE(mli.productName)}', 'createNew');displayColonWarning();"/>
                                                                            <span class="slds-radio--faux"></span>
                                                                            <span class="slds-form-element__label"></span>
                                                                        </label>
                                                                        <label  class="slds-text-heading--small" for="{!mli.srNo}cn">{!IF(mli.isInPurchaseMap,"Update Purchase Item in QuickBooks","Create a new Product/Service in QuickBooks")}</label>
                                                                        <div style='display:{!IF(mli.isInPurchaseMap,"block","none")};margin-top: 5px;margin-left: 2.5%;   border-radius: 5px;' class='infoM4'>This Product/Service already exists in QuickBooks Online but it is missing required information. You must specify the Revenue Code and whether this is taxable before it can be used as a line item on an Invoice.</div>
                                                                    </div>
                                                                    <div class="slds-grid slds-wrap" id="{!mli.srNo}nprdTable">
                                                                        <div id="{!mli.srNo}nprdTableP" class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-3 slds-large-size--1-of-3">
                                                                            <apex:inputText id="pname" value="{!missingLineItemMap[mlim].productName}"  styleClass="slds-input" onchange="displayColonWarning();"/>
                                                                        </div>
                                                                        
                                                                        <div id="{!mli.srNo}nprdTablePL" class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-3 slds-large-size--1-of-3">
                                                                            <apex:selectList styleClass="slds-input" id="accountCode" label="Tax/VAT" value="{!missingLineItemMap[mlim].selectedAccountId}" size="1">
                                                                                <apex:selectOptions value="{!QBOAccountList}"></apex:selectOptions>
                                                                            </apex:selectList>
                                                                        </div>
                                                                        
                                                                        <div id="{!mli.srNo}nprdTableT" class="slds-col--padded slds-size--1-of-1 slds-medium-size--1-of-3 slds-large-size--1-of-3" style="display:{!IF($ObjectType.Line_Item__c.fields.Tax__c.createable,'','none')}">
                                                                            <apex:outputPanel rendered="{!isUSTaxModel}">
                                                                                <div >
                                                                                    <label class="slds-checkbox">
                                                                                        <apex:inputCheckbox value="{!missingLineItemMap[mlim].isTaxable}"/>
                                                                                        <span class="slds-checkbox--faux"></span>
                                                                                        <span id="{!mli.srNo}nprdTableTx" class="slds-form-element__label">Taxable</span>
                                                                                    </label>
                                                                                    
                                                                                </div>
                                                                            </apex:outputPanel>
                                                                            <apex:outputPanel rendered="{!AND($ObjectType.breadwinner_qbo__Line_Item__c.fields.breadwinner_qbo__Tax_Code__c.createable,NOT(isUSTaxModel),QBOTaxCodeList.size>1)}">
                                                                                <apex:selectList styleClass="slds-input" id="mlitaxCode" value="{!missingLineItemMap[mlim].taxCodeSelected}" size="1">
                                                                                    <apex:selectOptions value="{!QBOTaxCodeList}"></apex:selectOptions>
                                                                                </apex:selectList>
                                                                            </apex:outputPanel>
                                                                        </div>
                                                                    </div>
                                                                    
                                                                </div>
                                                            </div>
                                                            <script>
                                                            if({!isReadOnlyMode}){
                                                                document.getElementById('{!mli.srNo}sm').checked = true;
                                                                pushTomissingLineItemMap('{!JSENCODE(mli.productName)}', 'matchWithExisting');
                                                                var divId = '#{!mli.srNo}nprdTable';
                                                                $('#'+'{!mli.srNo}cn').attr("disabled","disabled");
                                                                console.log('hi in if'+divId);
                                                                $(divId+'P').children().attr("disabled","disabled").addClass('makeGray');
                                                                $(divId+'PL').children().attr("disabled","disabled").addClass('makeGray');
                                                                $(divId+'T').find('*').attr("disabled","disabled").addClass('makeGray');
                                                                $(divId+'Tx').addClass('makeGray'); 
                                                            }
                                                            else{

                                                                document.getElementById('{!mli.srNo}cn').checked = true;
                                                                pushTomissingLineItemMap('{!JSENCODE(mli.productName)}', 'createNew');
                                                                var divId = '#{!mli.srNo}prdDiv'
                                                                $(divId).children().attr("disabled","disabled");;
                                                            }
                                                            </script>
                                                            <apex:variable var="row" value="{!row+1}"/>
                                                        </apex:repeat>
                                                    </div>
                                                    <div id="colonWarning" style="color:red;display:none;" class="slds-m-top--medium slds-m-bottom--medium">
                                                        Please Note: Using Colons, ‘:’, will create Multiple Products in QuickBooks Online, because a Colon is used to separate a Product from a SubProduct.                
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="popupfoot" class="slds-modal__footer slds-theme--default">
                                                <apex:commandButton value="Next" styleClass="slds-button slds-button--brand" action="{!createProductServices}" rerender="scriptPanel,JSPanel,theTable,PSPopop,isOAuth" status="popup-status" oncomplete="initSelect2();"/>
                                                <button type="button" class="slds-button slds-button--neutral close">Cancel</button>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    <div  class="slds-backdrop slds-backdrop--open"></div>
                                </div>  
                                
                        </apex:outputPanel>   
                        <!-- ------------------------------------- Popcode ends here ----------------------------------------- -->
                        <!-- --------------------------  Account/Opportunity Rollup Error popup --------------------------------------- -->
                        <apex:outputPanel id="ValidationErrorPopup">
                            <apex:outputPanel rendered="{!AccOppRollupsfailedMessage!=null}" >
                                <div role="alertdialog" tabindex="-1" aria-labelledby="Rollprompt-heading-id" aria-describedby="prompt-message-wrapper" class="slds-modal slds-fade-in-open slds-modal--prompt">
                                    <div class="slds-modal__container">
                                        <div class="slds-modal__header slds-theme--warning slds-theme--alert-texture">
                                            <h2 class="slds-text-heading--medium" id="Rollprompt-heading-id">Warning</h2>
                                        </div>
                                        <div class="slds-modal__content slds-p-around--medium">
                                            <div style="color:#54698d">
                                                <p>
                                                    Breadwinner was able to create the {!IF(createSalesReceipt,'Sales Receipt', 'Invoice')} [{!sfInvoice.name}] in QuickBooks Online and then successfully replicate it back to Salesforce. You can see it <a href="/{!sfInvoice.Id}">here</a>.
                                                </p>
                                                <p class="slds-m-top--small">
                                                    However, <b>Breadwinner could not update the summary fields in the related Account and Opportunity because of validation rules</b>. This means that the information on the Account or Opportunity will be inaccurate.
                                                </p>
                                                <p class="slds-m-top--small">
                                                    To resolve this, please disable or refine your Validation Rules. The specific validation error was:<span class="slds-text-body--small"><q> {!AccOppRollupsfailedMessage} </q></span>. 
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="slds-backdrop slds-backdrop--open"></div>
                                
                            </apex:outputPanel>
                        </apex:outputPanel>
                        <!-- --------------------------  Account/Opportunity Rollup Error popup --------------------------------------- -->
                    </div>
            </body>
            
        </html>
    </apex:form>
</apex:page>